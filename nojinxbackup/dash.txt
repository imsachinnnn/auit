<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard - {{ student.student_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" type="image/png">
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --secondary-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #5a7d7c;
            --accent-color-hover: #4a6b69;
            --light-accent-bg: #eef2f2;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-primary); margin: 0; padding: 40px 20px; }
        .container { max-width: 1100px; margin: auto; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-header .title-group { display: flex; align-items: center; gap: 15px; }
        .page-header .logo { height: 50px; width: auto; }
        .page-header h1 { margin: 0; font-size: 2em; font-weight: 600; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .action-btn { display: inline-block; padding: 10px 20px; border: none; border-radius: 6px; background-color: var(--accent-color); color: white; text-decoration: none; font-size: 1em; font-family: 'Poppins', sans-serif; cursor: pointer; transition: background-color 0.3s; }
        .action-btn:hover { background-color: var(--accent-color-hover); }
        
        /* --- UPDATED PROFILE HEADER STYLES --- */
        .profile-header-card {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 30px; /* Increased padding */
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px; /* Increased gap */
        }
        .profile-photo { width: 130px; height: 130px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary-bg); }
        .profile-info { width: 100%; } /* Allow info to take full width */
        .profile-info h2 { margin: 0 0 5px 0; font-size: 2em; } /* Larger name */
        .profile-info p { color: var(--text-secondary); margin: 0 0 20px 0; font-size: 1.1em; } /* Spacing below roll number */
        
        /* --- NEW ESSENTIAL LINKS STYLES --- */
        .essential-links {
            display: flex;
            flex-wrap: wrap; /* Allows links to wrap on smaller screens */
            gap: 12px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .essential-links a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background-color: var(--light-accent-bg);
            color: var(--accent-color);
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9em;
            transition: background-color 0.3s, color 0.3s;
        }
        .essential-links a:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
        .card { background-color: var(--secondary-bg); border-radius: 8px; border: 1px solid var(--border-color); box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 30px; }
        .card-title { font-size: 1.3em; font-weight: 600; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .details-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px 25px; }
        .detail-item { margin-bottom: 15px; }
        .detail-item strong { color: var(--text-secondary); display: block; margin-bottom: 5px; font-size: 0.9em; font-weight: 500; }
        .detail-item span, .detail-item a { word-wrap: break-word; }
        .detail-item a { color: var(--accent-color); text-decoration: none; font-weight: 500; }
        .detail-item a:hover { text-decoration: underline; }
        .academic-section { margin-top: 25px; }
        .academic-section:first-child { margin-top: 0; }
        .academic-section h4 { margin-bottom: 15px; color: var(--accent-color); }
        .scholarship-list { list-style-type: none; padding: 0; margin: 0; }
        .scholarship-list li { background-color: var(--primary-bg); padding: 8px 12px; border-radius: 5px; margin-bottom: 8px; font-size: 0.9em; }
        
        @media (max-width: 768px) {
            .profile-header-card { flex-direction: column; text-align: center; }
            .page-header { flex-direction: column; gap: 20px; }
            .essential-links { justify-content: center; } /* Center links on mobile */
        }
        @media print {
            .page-header, .profile-header-card, #documents-card { display: none !important; }
            body { padding: 0 !important; margin: 0 !important; background: #fff !important; color: #000 !important; }
            * { color: #000 !important; background: transparent !important; box-shadow: none !important; }
            .dashboard-grid { display: block !important; margin: 0 !important; padding: 0 !important; }
            .card { border: 1px solid #ccc !important; page-break-inside: avoid; margin: 0 0 5px 0 !important; padding: 8px 10px !important; width: 100% !important; box-sizing: border-box; }
            a, a:visited { text-decoration: underline; color: #000 !important; }
            body, .card { font-size: 12pt !important; line-height: 1.2 !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="page-header">
            <div class="title-group">
                <img src="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" alt="University Logo" class="logo">
                <h1>Student Dashboard</h1>
            </div>
            <div class="header-actions">
                <button onclick="window.print()" class="action-btn">üñ®Ô∏è Print Details</button>
                <!-- Corrected the URL to use the namespace -->
                <a href="{% url 'student_logout' %}" class="action-btn">Logout</a>
            </div>
        </header>

        <main>
            <!-- === MODIFIED PROFILE HEADER CARD === -->
            <div class="profile-header-card">
                {% if student.studentdocuments.student_photo %}
                    <img src="{{ student.studentdocuments.student_photo.url }}" alt="Student Photo" class="profile-photo">
                {% else %}
                    <img src="https://placehold.co/180x180/EFEFEF/AAAAAA?text=No+Photo" alt="No Photo Available" class="profile-photo">
                {% endif %}
                <div class="profile-info">
                    <h2>{{ student.student_name }}</h2>
                    <p>{{ student.roll_number }} | {{ student.get_program_level_display }}</p>
                    
                    <!-- === NEW ESSENTIAL LINKS SECTION === -->
                    <div class="essential-links">
                        <a href="{% url 'exam_timetable' %}"">üìÖ Timetable</a>
                        <a href="https://annamalaiuniversity.ac.in/aucoe/rs_view.php">üéì Results</a>
                        <a href="#">‚úÖ Attendance</a>
                        <a href="https://annamalaiuniversity.ac.in/studport/tf_general_pharmacy.php?fee=tf">üè´üí∞ Tution Fee Payment</a>
                        <a href="https://annamalaiuniversity.ac.in/studport/epayment_rgl_hfee.php?mode=oNln">üè†üí∞ Hostel Fee Payment</a>
                        <a href="#">‚úèÔ∏è Edit Profile</a>
                        <a href="https://annamalaiuniversity.ac.in/">üè´ AU Main Site</a>
                        <a href="{% url 'help_and_support' %}">‚ùì Help & Support</a>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="main-content">
                    <div class="card">
                        <h2 class="card-title">Personal & Contact Info</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Name</strong> <span>{{ student.student_name }}</span></div>
                            <div class="detail-item"><strong>Email</strong> <span>{{ student.student_email }}</span></div>
                            <div class="detail-item"><strong>Mobile</strong> <span>{{ student.personalinfo.student_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Date of Birth</strong> <span>{{ student.personalinfo.date_of_birth|date:"d M Y" }}</span></div>
                            <div class="detail-item"><strong>Gender</strong> <span>{{ student.personalinfo.gender|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Blood Group</strong> <span>{{ student.personalinfo.blood_group|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Community</strong> <span>{{ student.personalinfo.community|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Caste</strong> <span>{{ student.personalinfo.caste|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Religion</strong> <span>{{ student.personalinfo.religion|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>UMIS ID</strong> <span>{{ student.personalinfo.umis_id|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>EMIS ID</strong> <span>{{ student.personalinfo.emis_id|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>ABC ID</strong> <span>{{ student.personalinfo.abc_id|default:"N/A" }}</span></div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Parent Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Father's Name</strong> <span>{{ student.personalinfo.father_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Father's Mobile</strong> <span>{{ student.personalinfo.father_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Mother's Name</strong> <span>{{ student.personalinfo.mother_name|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Mother's Mobile</strong> <span>{{ student.personalinfo.mother_mobile|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Parent's Annual Income</strong> <span>{{ student.personalinfo.parent_annual_income|default:"N/A" }}</span></div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Academic History</h2>
                        
                        {% if student.academichistory.sslc_school_name %}
                        <div class="academic-section">
                            <h4>SSLC Details</h4>
                            <div class="details-grid">
                                <div class="detail-item"><strong>School</strong> <span>{{ student.academichistory.sslc_school_name }}</span></div>
                                <div class="detail-item"><strong>Percentage</strong> <span>{{ student.academichistory.sslc_percentage }}%</span></div>
                                <div class="detail-item"><strong>Year of Passing</strong> <span>{{ student.academichistory.sslc_year_of_passing }}</span></div>
                            </div>
                        </div>
                        {% endif %}

                        {% if student.academichistory.hsc_school_name %}
                        <div class="academic-section">
                            <h4>HSC Details</h4>
                            <div class="details-grid">
                                <div class="detail-item"><strong>School</strong> <span>{{ student.academichistory.hsc_school_name }}</span></div>
                                <div class="detail-item"><strong>Percentage</strong> <span>{{ student.academichistory.hsc_percentage }}%</span></div>
                                <div class="detail-item"><strong>Year of Passing</strong> <span>{{ student.academichistory.hsc_year_of_passing }}</span></div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if student.diplomadetails %}
                        <div class="academic-section">
                            <h4>Diploma Details</h4>
                            <div class="details-grid">
                                <div class="detail-item"><strong>College</strong> <span>{{ student.diplomadetails.diploma_college_name }}</span></div>
                                <div class="detail-item"><strong>Percentage</strong> <span>{{ student.diplomadetails.diploma_percentage }}%</span></div>
                                <div class="detail-item"><strong>Year of Passing</strong> <span>{{ student.diplomadetails.diploma_year_of_passing }}</span></div>
                            </div>
                        </div>
                        {% endif %}

                        {% if student.ugdetails %}
                        <div class="academic-section">
                            <h4>Undergraduate Details</h4>
                            <div class="details-grid">
                                <div class="detail-item"><strong>Course</strong> <span>{{ student.ugdetails.ug_course }}</span></div>
                                <div class="detail-item"><strong>OGPA</strong> <span>{{ student.ugdetails.ug_ogpa }}</span></div>
                                <div class="detail-item"><strong>Year of Passing</strong> <span>{{ student.ugdetails.ug_year_of_passing }}</span></div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if student.pgdetails %}
                        <div class="academic-section">
                            <h4>Postgraduate Details</h4>
                            <div class="details-grid">
                                <div class="detail-item"><strong>Course</strong> <span>{{ student.pgdetails.pg_course }}</span></div>
                                <div class="detail-item"><strong>OGPA</strong> <span>{{ student.pgdetails.pg_ogpa }}</span></div>
                                <div class="detail-item"><strong>Year of Passing</strong> <span>{{ student.pgdetails.pg_year_of_passing }}</span></div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="side-content">
                    <div class="card">
                        <h2 class="card-title">Scholarship Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Applying for Scholarship?</strong> <span>{% if student.scholarshipinfo.has_scholarship %}Yes{% else %}No{% endif %}</span></div>
                            {% if student.scholarshipinfo.has_scholarship %}
                            <div class="detail-item">
                                <strong>Scholarships</strong>
                                <ul class="scholarship-list">
                                    {% if student.scholarshipinfo.is_first_graduate %}<li>First Graduate</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_bcmbc %}<li>BC/MBC</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_postmetric %}<li>Post Metric</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_pm %}<li>Prime Minister Scheme</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_govt %}<li>Govt 7.5%</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_pudhumai %}<li>Pudhumai Penn</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_tamizh %}<li>Tamizh Pudhalvan</li>{% endif %}
                                    {% if student.scholarshipinfo.sch_private %}<li>Private: {{ student.scholarshipinfo.private_scholarship_name }}</li>{% endif %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Other Details</h2>
                        <div class="details-grid">
                            <div class="detail-item"><strong>Ambition</strong> <span>{{ student.otherdetails.ambition|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Role Model</strong> <span>{{ student.otherdetails.role_model|default:"N/A" }}</span></div>
                            <div class="detail-item"><strong>Hobbies</strong> <span>{{ student.otherdetails.hobbies|default:"N/A" }}</span></div>
                        </div>
                    </div>

                    <div class="card" id="documents-card">
                        <h2 class="card-title">Uploaded Documents</h2>
                        <div class="details-grid">
                            {% with doc=student.studentdocuments %}
                                <div class="detail-item"><strong>ID Card</strong> {% if doc.student_id_card %}<a href="{{ doc.student_id_card.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>Community Cert.</strong> {% if doc.community_certificate %}<a href="{{ doc.community_certificate.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>Aadhaar Card</strong> {% if doc.aadhaar_card %}<a href="{{ doc.aadhaar_card.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>First Graduate Cert.</strong> {% if doc.first_graduate_certificate %}<a href="{{ doc.first_graduate_certificate.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>SSLC Marksheet</strong> {% if doc.sslc_marksheet %}<a href="{{ doc.sslc_marksheet.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>HSC Marksheet</strong> {% if doc.hsc_marksheet %}<a href="{{ doc.hsc_marksheet.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>Income Cert.</strong> {% if doc.income_certificate %}<a href="{{ doc.income_certificate.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                                <div class="detail-item"><strong>Bank Passbook</strong> {% if doc.bank_passbook %}<a href="{{ doc.bank_passbook.url }}" target="_blank">View</a>{% else %}<span>N/A</span>{% endif %}</div>
                            {% endwith %}
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>