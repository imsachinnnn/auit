<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Bio-Data Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    {% load static %}
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Custom Student CSS -->
    <link rel="stylesheet" href="{% static 'css/student_style.css' %}">
</head>

<body>
    <div class="container">
        <div class="form-header">
            <img src="{% static 'imgs/aublack.png' %}" alt="University Logo" width="150" height="auto" />
            <h1>Complete Your Profile</h1>
            <p>Department of Information Technology</p>
            <div class="alert alert-info" style="font-size: 0.9em; margin-top: 10px;">
                Welcome, {{ student.student_name }}! Please complete your profile and set a new password to proceed.
            </div>
        </div>

        <form id="registration-form" method="POST" enctype="multipart/form-data" novalidate
            data-register-url="{% url 'api_register_student' %}" data-success-url="{% url 'student_dashboard' %}">
            {% csrf_token %}

            <!-- STUDENT & LOGIN DETAILS -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Student & Login Details</h2>
                </div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="student_name">Name</label>
                            <input type="text" id="student_name" name="student_name" value="{{ student.student_name }}"
                                required>
                        </div>
                        <div class="input-group">
                            <label for="roll_number">Roll Number</label>
                            <input type="text" id="roll_number" name="roll_number" value="{{ student.roll_number }}"
                                readonly style="background-color: #e9ecef;">
                        </div>
                        <div class="input-group">
                            <label for="register_number">Register Number</label>
                            <input type="text" id="register_number" name="register_number"
                                value="{{ student.register_number|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="student_email">Email</label>
                            <input type="email" id="student_email" name="student_email" required
                                value="{{ student.student_email|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="password">New Password</label>
                            <input type="password" id="password" name="password" required
                                placeholder="Enter new password">
                        </div>
                        <div class="input-group">
                            <label for="confirm-password">Confirm New Password</label>
                            <input type="password" id="confirm-password" required placeholder="Confirm new password">
                        </div>
                    </div>
                </div>
            </div>

            <!-- PERSONAL & PARENT INFORMATION -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Personal & Parent Information</h2>
                </div>
                <div class="accordion-content">
                    <h3>Personal Details</h3>
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="umis_id">UMIS ID</label>
                            <input type="text" id="umis_id" name="umis_id" value="{{ personal.umis_id|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="emis_id">EMIS ID</label>
                            <input type="text" id="emis_id" name="emis_id" value="{{ personal.emis_id|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="abc_id">ABC ID</label>
                            <input type="text" id="abc_id" name="abc_id" value="{{ personal.abc_id|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="date_of_birth">Date of Birth</label>
                            <input type="date" id="date_of_birth" name="date_of_birth" required
                                value="{{ personal.date_of_birth|date:'Y-m-d' }}">
                        </div>
                        <div class="input-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" required>
                                <option value="">-- Select --</option>
                                <option value="Male" {% if personal.gender=="Male" %}selected{% endif %}>Male</option>
                                <option value="Female" {% if personal.gender=="Female" %}selected{% endif %}>Female
                                </option>
                                <option value="Other" {% if personal.gender=="Other" %}selected{% endif %}>Other
                                </option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="blood_group">Blood Group</label>
                            <select id="blood_group" name="blood_group">
                                <option value="">-- Select --</option>
                                <option value="O+" {% if personal.blood_group=="O+" %}selected{% endif %}>O+</option>
                                <option value="O-" {% if personal.blood_group=="O-" %}selected{% endif %}>O-</option>
                                <option value="A+" {% if personal.blood_group=="A+" %}selected{% endif %}>A+</option>
                                <option value="A-" {% if personal.blood_group=="A-" %}selected{% endif %}>A-</option>
                                <option value="B+" {% if personal.blood_group=="B+" %}selected{% endif %}>B+</option>
                                <option value="B-" {% if personal.blood_group=="B-" %}selected{% endif %}>B-</option>
                                <option value="AB+" {% if personal.blood_group=="AB+" %}selected{% endif %}>AB+</option>
                                <option value="AB-" {% if personal.blood_group=="AB-" %}selected{% endif %}>AB-</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="community">Community</label>
                            <select id="community" name="community" required>
                                <option value="">-- Select --</option>
                                <option value="OC" {% if personal.community=="OC" %}selected{% endif %}>OC</option>
                                <option value="BC" {% if personal.community=="BC" %}selected{% endif %}>BC</option>
                                <option value="MBC" {% if personal.community=="MBC" %}selected{% endif %}>MBC</option>
                                <option value="SC" {% if personal.community=="SC" %}selected{% endif %}>SC</option>
                                <option value="ST" {% if personal.community=="ST" %}selected{% endif %}>ST</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="caste">Caste</label>
                            <select id="caste" name="caste"
                                data-selected="{{ personal.caste.name|default:'' }}"></select>
                        </div>
                        <div class="input-group" id="caste-other-group" style="display: none;">
                            <label for="caste_other">Please Specify Caste</label>
                            <input type="text" id="caste_other" name="caste_other"
                                value="{{ personal.caste_other|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="religion">Religion</label>
                            <select id="religion" name="religion">
                                <option value="Hindu" {% if personal.religion=="Hindu" %}selected{% endif %}>Hindu
                                </option>
                                <option value="Christian" {% if personal.religion=="Christian" %}selected{% endif %}>
                                    Christian</option>
                                <option value="Muslim" {% if personal.religion=="Muslim" %}selected{% endif %}>Muslim
                                </option>
                                <option value="Other" {% if personal.religion=="Other" %}selected{% endif %}>Other
                                </option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="aadhaar_number">Aadhaar Number</label>
                            <input type="text" id="aadhaar_number" name="aadhaar_number"
                                value="{{ personal.aadhaar_number|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="permanent_address">Permanent Address</label>
                            <textarea id="permanent_address" name="permanent_address"
                                required>{{ personal.permanent_address|default:'' }}</textarea>
                        </div>
                        <div class="input-group">
                            <label for="present_address">Present Address</label>
                            <textarea id="present_address"
                                name="present_address">{{ personal.present_address|default:'' }}</textarea>
                        </div>
                        <div class="input-group radio-group">
                            <label>Are you applying for a scholarship?</label>
                            <div>
                                <input type="radio" id="scholarship-yes" name="has_scholarship" value="yes" {% if
                                    personal.has_scholarship %}checked{% endif %}>
                                <label for="scholarship-yes">Yes</label>
                                <input type="radio" id="scholarship-no" name="has_scholarship" value="no" {% if not
                                    personal.has_scholarship %}checked{% endif %}>
                                <label for="scholarship-no">No</label>
                            </div>
                        </div>
                    </div>

                    <h3>Parent & Contact Details</h3>
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="student_mobile">Student Mobile</label>
                            <input type="tel" id="student_mobile" name="student_mobile" required
                                value="{{ personal.student_mobile|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="parent_email">Parent Email</label>
                            <input type="email" id="parent_email" name="parent_email"
                                value="{{ personal.parent_email|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="father_name">Father's Name</label>
                            <input type="text" id="father_name" name="father_name"
                                value="{{ personal.father_name|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="father_occupation">Father's Occupation</label>
                            <input type="text" id="father_occupation" name="father_occupation"
                                value="{{ personal.father_occupation|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="father_mobile">Father's Mobile</label>
                            <input type="tel" id="father_mobile" name="father_mobile"
                                value="{{ personal.father_mobile|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="mother_name">Mother's Name</label>
                            <input type="text" id="mother_name" name="mother_name"
                                value="{{ personal.mother_name|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="mother_occupation">Mother's Occupation</label>
                            <input type="text" id="mother_occupation" name="mother_occupation"
                                value="{{ personal.mother_occupation|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="mother_mobile">Mother's Mobile</label>
                            <input type="tel" id="mother_mobile" name="mother_mobile"
                                value="{{ personal.mother_mobile|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="parent_annual_income">Parent's Annual Income</label>
                            <input type="number" id="parent_annual_income" name="parent_annual_income" min="0"
                                value="{{ personal.parent_annual_income|default:'' }}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACADEMIC DETAILS -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Academic Details</h2>
                </div>
                <div class="accordion-content">
                    <div class="input-group">
                        <label for="program_level">Current Program Level</label>
                        <select id="program_level" name="program_level" required>
                            <option value="">-- Select Program --</option>
                            <option value="UG" {% if student.program_level=="UG" %}selected{% endif %}>Undergraduate
                            </option>
                            <option value="PG" {% if student.program_level=="PG" %}selected{% endif %}>Postgraduate
                            </option>
                            <option value="PHD" {% if student.program_level=="PHD" %}selected{% endif %}>PhD</option>
                        </select>
                    </div>

                    <div id="current-program-details-section" class="conditional-section">
                        <h3>Current Program Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label for="current_semester">Current Semester</label>
                                <select id="current_semester" name="current_semester" required>
                                    <option value="">-- Select Semester --</option>
                                    <option value="1" {% if student.current_semester==1 %}selected{% endif %}>Semester 1
                                    </option>
                                    <option value="2" {% if student.current_semester==2 %}selected{% endif %}>Semester 2
                                    </option>
                                    <option value="3" {% if student.current_semester==3 %}selected{% endif %}>Semester 3
                                    </option>
                                    <option value="4" {% if student.current_semester==4 %}selected{% endif %}>Semester 4
                                    </option>
                                    <option value="5" {% if student.current_semester==5 %}selected{% endif %}>Semester 5
                                    </option>
                                    <option value="6" {% if student.current_semester==6 %}selected{% endif %}>Semester 6
                                    </option>
                                    <option value="7" {% if student.current_semester==7 %}selected{% endif %}>Semester 7
                                    </option>
                                    <option value="8" {% if student.current_semester==8 %}selected{% endif %}>Semester 8
                                    </option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="joining_year">Joining Year</label>
                                <select id="joining_year" name="joining_year" class="year-picker" required
                                    data-selected="{{ student.joining_year|default:'' }}"></select>
                            </div>
                            <div class="input-group">
                                <label for="ending_year">Ending Year (Batch)</label>
                                <select id="ending_year" name="ending_year" class="year-picker" required
                                    data-selected="{{ student.ending_year|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="ug-entry-type-section" class="conditional-section">
                        <div class="input-group">
                            <label for="ug_entry_type">UG Entry Type</label>
                            <select id="ug_entry_type" name="ug_entry_type">
                                <option value="">-- Select Entry Type --</option>
                                <option value="Regular" {% if student.ug_entry_type=="Regular" %}selected{% endif %}>
                                    Regular (HSC)</option>
                                <option value="Lateral" {% if student.ug_entry_type=="Lateral" %}selected{% endif %}>
                                    Lateral (Diploma)</option>
                                <option value="Rejoin" {% if student.ug_entry_type=="Rejoin" %}selected{% endif %}>
                                    Rejoin</option>
                            </select>
                        </div>
                    </div>

                    <div id="sslc-details-section" class="conditional-section">
                        <h3>SSLC Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>SSLC School Name</label>
                                <input type="text" name="sslc_school_name"
                                    value="{{ academic.sslc_school_name|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>SSLC School Address</label>
                                <textarea
                                    name="sslc_school_address">{{ academic.sslc_school_address|default:'' }}</textarea>
                            </div>
                            <div class="input-group">
                                <label>SSLC Register Number</label>
                                <input type="text" name="sslc_register_number"
                                    value="{{ academic.sslc_register_number|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>SSLC Overall Percentage</label>
                                <input type="number" step="0.01" min="0" max="100" name="sslc_percentage"
                                    value="{{ academic.sslc_percentage|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>SSLC Year of Passing</label>
                                <select name="sslc_year_of_passing" class="year-picker"
                                    data-selected="{{ academic.sslc_year_of_passing|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="hsc-details-section" class="conditional-section">
                        <h3>HSC Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>HSC School Name</label>
                                <input type="text" name="hsc_school_name"
                                    value="{{ academic.hsc_school_name|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>HSC School Address</label>
                                <textarea
                                    name="hsc_school_address">{{ academic.hsc_school_address|default:'' }}</textarea>
                            </div>
                            <div class="input-group">
                                <label>HSC Register Number</label>
                                <input type="text" name="hsc_register_number"
                                    value="{{ academic.hsc_register_number|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>HSC Overall Percentage</label>
                                <input type="number" step="0.01" min="0" max="100" name="hsc_percentage"
                                    value="{{ academic.hsc_percentage|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>HSC Year of Passing</label>
                                <select name="hsc_year_of_passing" class="year-picker"
                                    data-selected="{{ academic.hsc_year_of_passing|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="diploma-details-section" class="conditional-section">
                        <h3>Diploma Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>Diploma College Name</label>
                                <input type="text" name="diploma_college_name"
                                    value="{{ diploma.diploma_college_name|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>Diploma College Address</label>
                                <textarea
                                    name="diploma_college_address">{{ diploma.diploma_college_address|default:'' }}</textarea>
                            </div>
                            <div class="input-group">
                                <label>Diploma Register Number</label>
                                <input type="text" name="diploma_register_number"
                                    value="{{ diploma.diploma_register_number|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>Diploma Overall Percentage</label>
                                <input type="number" step="0.01" min="0" max="100" name="diploma_percentage"
                                    value="{{ diploma.diploma_percentage|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>Diploma Year of Passing</label>
                                <select name="diploma_year_of_passing" class="year-picker"
                                    data-selected="{{ diploma.diploma_year_of_passing|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="ug-details-section" class="conditional-section">
                        <h3>UG Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>UG Course</label>
                                <input type="text" name="ug_course" value="{{ ug.ug_course|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>UG University</label>
                                <input type="text" name="ug_university" value="{{ ug.ug_university|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>UG OGPA (out of 100)</label>
                                <input type="number" step="0.01" min="0" max="100" name="ug_ogpa"
                                    value="{{ ug.ug_ogpa|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>UG Year of Passing</label>
                                <select name="ug_year_of_passing" class="year-picker"
                                    data-selected="{{ ug.ug_year_of_passing|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="pg-details-section" class="conditional-section">
                        <h3>PG Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>PG Course</label>
                                <input type="text" name="pg_course" value="{{ pg.pg_course|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>PG University</label>
                                <input type="text" name="pg_university" value="{{ pg.pg_university|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>PG OGPA (out of 100)</label>
                                <input type="number" step="0.01" min="0" max="100" name="pg_ogpa"
                                    value="{{ pg.pg_ogpa|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>PG Year of Passing</label>
                                <select name="pg_year_of_passing" class="year-picker"
                                    data-selected="{{ pg.pg_year_of_passing|default:'' }}"></select>
                            </div>
                        </div>
                    </div>

                    <div id="phd-details-section" class="conditional-section">
                        <h3>PhD Details</h3>
                        <div class="form-grid">
                            <div class="input-group">
                                <label>PhD Specialization</label>
                                <input type="text" name="phd_specialization"
                                    value="{{ phd.phd_specialization|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>PhD University</label>
                                <input type="text" name="phd_university" value="{{ phd.phd_university|default:'' }}">
                            </div>
                            <div class="input-group">
                                <label>PhD Year of Joining</label>
                                <select name="phd_year_of_joining" class="year-picker"
                                    data-selected="{{ phd.phd_year_of_joining|default:'' }}"></select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BANK DETAILS -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Bank Details</h2>
                </div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="account_holder_name">Account Holder's Name</label>
                            <input type="text" id="account_holder_name" name="account_holder_name"
                                value="{{ bank.account_holder_name|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="account_number">Account Number</label>
                            <input type="text" id="account_number" name="account_number"
                                value="{{ bank.account_number|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="bank_name">Bank Name</label>
                            <input type="text" id="bank_name" name="bank_name" value="{{ bank.bank_name|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="branch_name">Branch Name</label>
                            <input type="text" id="branch_name" name="branch_name"
                                value="{{ bank.branch_name|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="ifsc_code">IFSC Code</label>
                            <input type="text" id="ifsc_code" name="ifsc_code" value="{{ bank.ifsc_code|default:'' }}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- SCHOLARSHIP DETAILS -->
            <div id="scholarship-accordion-item" class="accordion-item" style="display: none;">
                <div class="accordion-header">
                    <h2>Scholarship Details</h2>
                </div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>First Graduate</label>
                                <input type="checkbox" id="is_first_graduate_sch" name="is_first_graduate" {% if
                                    scholarship.is_first_graduate %}checked{% endif %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>BC/MBC</label>
                                <input type="checkbox" name="sch_bcmbc" {% if scholarship.sch_bcmbc %}checked{% endif
                                    %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Post Metric</label>
                                <input type="checkbox" name="sch_postmetric" {% if scholarship.sch_postmetric
                                    %}checked{% endif %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Prime Minister Scheme</label>
                                <input type="checkbox" name="sch_pm" {% if scholarship.sch_pm %}checked{% endif %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Govt 7.5%</label>
                                <input type="checkbox" name="sch_govt" {% if scholarship.sch_govt %}checked{% endif %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Pudhumai Penn</label>
                                <input type="checkbox" name="sch_pudhumai" {% if scholarship.sch_pudhumai %}checked{%
                                    endif %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Tamizh Pudhalvan</label>
                                <input type="checkbox" name="sch_tamizh" {% if scholarship.sch_tamizh %}checked{% endif
                                    %}>
                            </div>
                        </div>
                        <div class="input-group">
                            <div class="checkbox-group">
                                <label>Private Scholarship</label>
                                <input type="checkbox" id="sch_private" name="sch_private" {% if scholarship.sch_private
                                    %}checked{% endif %}>
                            </div>
                        </div>
                    </div>

                    <div id="private-scholarship-name-section" class="conditional-section">
                        <div class="input-group">
                            <label for="private_scholarship_name">Private Scholarship Name</label>
                            <input type="text" id="private_scholarship_name" name="private_scholarship_name"
                                value="{{ scholarship.private_scholarship_name|default:'' }}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- DOCUMENT UPLOADS -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Document Uploads</h2>
                </div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="student_photo">Student Photo <span style="font-size:0.8em; color:#6c757d;">(Max:
                                    100KB)</span></label>
                            <input type="file" id="student_photo" name="student_photo" accept="image/*">
                        </div>
                        <div class="input-group">
                            <label for="student_id_card">Student ID Card <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="student_id_card" name="student_id_card">
                        </div>
                        <div class="input-group">
                            <label for="community_certificate">Community Certificate <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="community_certificate" name="community_certificate">
                        </div>
                        <div class="input-group">
                            <label for="aadhaar_card">Aadhaar Card <span style="font-size:0.8em; color:#6c757d;">(Max:
                                    100KB)</span></label>
                            <input type="file" id="aadhaar_card" name="aadhaar_card">
                        </div>
                        <div class="input-group">
                            <label for="sslc_marksheet">SSLC Marksheet <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="sslc_marksheet" name="sslc_marksheet">
                        </div>
                        <div class="input-group">
                            <label for="hsc_marksheet">HSC Marksheet <span style="font-size:0.8em; color:#6c757d;">(Max:
                                    100KB)</span></label>
                            <input type="file" id="hsc_marksheet" name="hsc_marksheet">
                        </div>
                        <div class="input-group">
                            <label for="income_certificate">Income Certificate <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="income_certificate" name="income_certificate">
                        </div>
                        <div class="input-group">
                            <label for="bank_passbook">Bank Passbook <span style="font-size:0.8em; color:#6c757d;">(Max:
                                    100KB)</span></label>
                            <input type="file" id="bank_passbook" name="bank_passbook">
                        </div>
                        <div class="input-group">
                            <label for="driving_license">Driving License <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="driving_license" name="driving_license">
                        </div>
                        <div id="fg-cert-upload-section" class="input-group conditional-section">
                            <label for="first_graduate_certificate">First Graduate Certificate <span
                                    style="font-size:0.8em; color:#6c757d;">(Max: 100KB)</span></label>
                            <input type="file" id="first_graduate_certificate" name="first_graduate_certificate">
                        </div>
                    </div>
                </div>
            </div>

            <!-- OTHER DETAILS -->
            <div class="accordion-item">
                <div class="accordion-header">
                    <h2>Other Details</h2>
                </div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="ambition">Ambition</label>
                            <input type="text" id="ambition" name="ambition" value="{{ other.ambition|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="role_model">Role Model</label>
                            <input type="text" id="role_model" name="role_model"
                                value="{{ other.role_model|default:'' }}">
                        </div>
                        <div class="input-group">
                            <label for="hobbies">Hobbies</label>
                            <textarea id="hobbies" name="hobbies">{{ other.hobbies|default:'' }}</textarea>
                        </div>
                        <div class="input-group">
                            <label for="identification_marks">Identification Marks</label>
                            <textarea id="identification_marks"
                                name="identification_marks">{{ other.identification_marks|default:'' }}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">Complete Registration</button>
        </form>
    </div>

    <script src="{% static 'js/file-upload-validation.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let subCasteData = {};

            const form = document.getElementById('registration-form');



            function updateActiveAccordionHeight() {
                const activeItem = document.querySelector('.accordion-item.active');
                if (activeItem) {
                    const content = activeItem.querySelector('.accordion-content');
                    // Reset to hidden during calculation/transition
                    content.style.overflow = 'hidden';
                    setTimeout(() => {
                        content.style.maxHeight = content.scrollHeight + "px";

                        // AFTER transition (approx 300ms), let it overflow so dropdowns aren't cut
                        setTimeout(() => {
                            if (activeItem.classList.contains('active')) {
                                content.style.overflow = 'visible';
                            }
                        }, 350);
                    }, 50);
                }
            }

            // Accordion
            const accordionItems = document.querySelectorAll('.accordion-item');
            if (accordionItems.length > 0) {
                accordionItems[0].classList.add('active');
                const firstContent = accordionItems[0].querySelector('.accordion-content');
                if (firstContent) {
                    firstContent.style.maxHeight = firstContent.scrollHeight + "px";
                    // Immediately visible for initial state
                    firstContent.style.overflow = 'visible';
                }
            }

            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                if (!header) return;

                header.addEventListener('click', () => {
                    const content = item.querySelector('.accordion-content');
                    const isActive = item.classList.contains('active');

                    document.querySelectorAll('.accordion-item.active').forEach(openItem => {
                        openItem.classList.remove('active');
                        const openContent = openItem.querySelector('.accordion-content');
                        if (openContent) {
                            openContent.style.overflow = 'hidden'; // Hide overflow when closing
                            openContent.style.maxHeight = '0px';
                        }
                    });

                    if (!isActive) {
                        item.classList.add('active');
                        if (content) {
                            // Start with hidden for the animation
                            content.style.overflow = 'hidden';
                            content.style.maxHeight = content.scrollHeight + "px";

                            // Switch to visible after animation finishes
                            setTimeout(() => {
                                if (item.classList.contains('active')) {
                                    content.style.overflow = 'visible';
                                }
                            }, 350);
                        }
                    }
                });
            });

            // Year pickers
            document.querySelectorAll('.year-picker').forEach(dropdown => {
                const currentYear = new Date().getFullYear();
                let startLoopYear = currentYear;
                if (dropdown.id === 'ending_year') startLoopYear = currentYear + 6;
                const minYear = currentYear - 40;

                const placeholder = document.createElement('option');
                placeholder.value = "";
                placeholder.textContent = "-- Select Year --";
                dropdown.appendChild(placeholder);

                for (let year = startLoopYear; year >= minYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;

                    // Pre-select if data-selected matches
                    if (dropdown.getAttribute('data-selected') == year) {
                        option.selected = true;
                    }

                    dropdown.appendChild(option);
                }
            });

            // Caste logic
            const communitySelect = document.getElementById('community');
            const casteSelect = document.getElementById('caste');
            const casteOtherGroup = document.getElementById('caste-other-group');

            function updateCasteOptions() {
                if (!casteSelect) return;
                const selectedCommunity = communitySelect ? communitySelect.value : "";
                const castes = subCasteData[selectedCommunity] || [];

                casteSelect.innerHTML = '';
                casteOtherGroup.style.display = 'none';

                if (castes.length === 0) {
                    const opt = document.createElement('option');
                    opt.value = '';
                    opt.textContent = 'Select Community First';
                    casteSelect.appendChild(opt);
                } else {
                    const opt = document.createElement('option');
                    opt.value = '';
                    opt.textContent = '-- Select --';
                    casteSelect.appendChild(opt);

                    castes.forEach(c => {
                        const o = document.createElement('option');
                        o.value = c;
                        o.textContent = c;
                        casteSelect.appendChild(o);
                    });

                    const other = document.createElement('option');
                    other.value = 'Other';
                    other.textContent = 'Other';
                    casteSelect.appendChild(other);

                    // Handle Pre-selection
                    const selected = casteSelect.getAttribute('data-selected');
                    if (selected) {
                        casteSelect.value = selected;
                        // If value isn't found (e.g. it was 'Other' but named specifically?), check logic
                        // Actually if 'selected' is not in options, it might be custom.
                        // But we just appended options from DB.
                        // If it was 'Other', the value 'Other' is there.
                        // If user typed something in 'Other', the select value should be 'Other'.

                        if (casteSelect.value !== selected && selected !== '') {
                            // Potentially it's a custom value that fell into "Other"? 
                            // Or maybe the loop didn't cover it?
                            // Assuming standard usage:
                            casteSelect.value = 'Other';
                        }

                        // trigger change to show/hide other input
                        casteSelect.dispatchEvent(new Event('change'));
                    }
                }
            }

            if (communitySelect) communitySelect.addEventListener('change', updateCasteOptions);

            if (casteSelect) {
                casteSelect.addEventListener('change', function () {
                    casteOtherGroup.style.display = this.value === 'Other' ? 'block' : 'none';
                    updateActiveAccordionHeight();
                });
            }

            // Conditional logic for program and entry type
            const programLevelSelect = document.getElementById('program_level');
            const ugEntryTypeSection = document.getElementById('ug-entry-type-section');
            const ugEntryTypeSelect = document.getElementById('ug_entry_type');

            function handleEntryTypeChange() {
                if (!ugEntryTypeSelect) return;
                const entry = ugEntryTypeSelect.value;

                const sslcSection = document.getElementById('sslc-details-section');
                const hscSection = document.getElementById('hsc-details-section');
                const diplomaSection = document.getElementById('diploma-details-section');

                if (sslcSection) sslcSection.style.display = (entry === 'Regular' || entry === 'Lateral') ? 'block' : 'none';
                if (hscSection) hscSection.style.display = (entry === 'Regular') ? 'block' : 'none';
                if (diplomaSection) diplomaSection.style.display = (entry === 'Lateral') ? 'block' : 'none';

                updateActiveAccordionHeight();
            }

            function handleProgramChange() {
                if (!programLevelSelect) return;
                const level = programLevelSelect.value;

                const currentProgramSection = document.getElementById('current-program-details-section');
                if (currentProgramSection) {
                    currentProgramSection.style.display = level ? 'block' : 'none';
                }

                if (ugEntryTypeSection) {
                    ugEntryTypeSection.style.display = level === 'UG' ? 'block' : 'none';
                }

                const sslcSection = document.getElementById('sslc-details-section');
                const ugSection = document.getElementById('ug-details-section');
                const pgSection = document.getElementById('pg-details-section');
                const phdSection = document.getElementById('phd-details-section');

                if (sslcSection) sslcSection.style.display = 'none';
                if (ugSection) ugSection.style.display = (level === 'PG' || level === 'PHD') ? 'block' : 'none';
                if (pgSection) pgSection.style.display = (level === 'PHD') ? 'block' : 'none';
                if (phdSection) phdSection.style.display = (level === 'PHD') ? 'block' : 'none';

                handleEntryTypeChange();
                updateActiveAccordionHeight();
            }

            if (programLevelSelect) programLevelSelect.addEventListener('change', handleProgramChange);
            if (ugEntryTypeSelect) ugEntryTypeSelect.addEventListener('change', handleEntryTypeChange);

            // Scholarship visibility
            const schRadios = document.querySelectorAll('input[name="has_scholarship"]');
            const scholarshipAccordionItem = document.getElementById('scholarship-accordion-item');
            const schPrivateCheckbox = document.getElementById('sch_private');
            const privateScholarshipSection = document.getElementById('private-scholarship-name-section');
            const fgCheckbox = document.getElementById('is_first_graduate_sch');
            const fgCertSection = document.getElementById('fg-cert-upload-section');

            schRadios.forEach(r => r.addEventListener('change', () => {
                const checked = document.querySelector('input[name="has_scholarship"]:checked');
                const val = checked ? checked.value : 'no';
                if (scholarshipAccordionItem) {
                    scholarshipAccordionItem.style.display = (val === 'yes') ? 'block' : 'none';
                }
                updateActiveAccordionHeight();
            }));

            if (schPrivateCheckbox && privateScholarshipSection) {
                schPrivateCheckbox.addEventListener('change', () => {
                    privateScholarshipSection.style.display = schPrivateCheckbox.checked ? 'block' : 'none';
                    updateActiveAccordionHeight();
                });
            }

            if (fgCheckbox && fgCertSection) {
                fgCheckbox.addEventListener('change', () => {
                    fgCertSection.style.display = fgCheckbox.checked ? 'block' : 'none';
                    updateActiveAccordionHeight();
                });
            }



            // Fetch caste data
            async function fetchCasteData() {
                try {
                    const response = await fetch("{% url 'api_get_castes' %}");
                    if (response.ok) {
                        subCasteData = await response.json();
                        updateCasteOptions();
                    }
                } catch (e) {
                    console.error(e);
                }
            }

            // Initial calls
            fetchCasteData();
            handleProgramChange();  // initialise conditional sections
        });
    </script>
    <script src="{% static 'js/registration_validation.js' %}?v=1.2"></script>
</body>

</html>