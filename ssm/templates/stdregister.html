<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Bio-Data Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    {% load static %}
    <!-- This should link to your main.css file if you are using a base template -->
    <!-- <link rel="stylesheet" href="{% static 'css/main.css' %}"> -->
    <style>
        :root {
            --primary-bg: #f8f9fa;
            --secondary-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #5a7d7c;
            --accent-color-hover: #4a6b69;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-primary); margin: 0; padding: 40px 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .form-header { text-align: center; margin-bottom: 40px; }
        .form-header h1 { font-size: 2.5em; margin: 0; }
        .form-header p { color: var(--text-secondary); font-size: 1.1em; }
        .accordion-item { background-color: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .accordion-header { padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .accordion-header h2 { margin: 0; font-size: 1.2em; font-weight: 600; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; padding: 0 20px; }
        .accordion-item.active .accordion-content { padding: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }
        .input-group input, .input-group select, .input-group textarea { background-color: #fff; border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 1em; width: 100%; box-sizing: border-box; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; }
        .radio-group { flex-direction: row; align-items: center; gap: 20px; padding: 10px 0; }
        .radio-group > label { margin-bottom: 0; }
        .radio-group > div { display: flex; align-items: center; gap: 25px; }
        .radio-group > div > label { font-weight: 400; color: var(--text-primary); }
        .conditional-section { display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        .submit-btn { background-color: var(--accent-color); color: #ffffff; border: none; padding: 15px 30px; font-size: 1.1em; font-weight: 600; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; width: 100%; margin-top: 20px; }
        .submit-btn:hover { background-color: var(--accent-color-hover); }
        h3 { border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 10px; color: var(--accent-color); }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <img src="{% static 'imgs/aublack.png' %}" alt="University Logo" width="150" height="auto"/>
            <h1>Student Registration</h1>
            <p>Department of Information Technology</p>
        </div>

        <form id="registration-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="accordion-item">
                <div class="accordion-header"><h2>Student & Login Details</h2></div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group"><label for="student_name">Name</label><input type="text" id="student_name" name="student_name" required></div>
                        <div class="input-group"><label for="roll_number">Roll Number</label><input type="text" id="roll_number" name="roll_number" required></div>
                        <div class="input-group"><label for="register_number">Register Number</label><input type="text" id="register_number" name="register_number"></div>
                        <div class="input-group"><label for="student_email">Email</label><input type="email" id="student_email" name="student_email" required></div>
                        <div class="input-group"><label for="password">Password</label><input type="password" id="password" name="password" required></div>
                        <div class="input-group"><label for="confirm-password">Confirm Password</label><input type="password" id="confirm-password" required></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header"><h2>Personal & Parent Information</h2></div>
                <div class="accordion-content">
                    <h3>Personal Details</h3>
                    <div class="form-grid">
                        <div class="input-group"><label for="umis_id">UMIS ID</label><input type="text" id="umis_id" name="umis_id"></div>
                        <div class="input-group"><label for="emis_id">EMIS ID</label><input type="text" id="emis_id" name="emis_id"></div>
                        <div class="input-group"><label for="abc_id">ABC ID</label><input type="text" id="abc_id" name="abc_id"></div>
                        <div class="input-group"><label for="date_of_birth">Date of Birth</label><input type="date" id="date_of_birth" name="date_of_birth"></div>
                        <div class="input-group"><label for="gender">Gender</label><select id="gender" name="gender"><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>
                        <div class="input-group"><label for="blood_group">Blood Group</label><select id="blood_group" name="blood_group"><option value="O+">O+</option><option value="O-">O-</option><option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="AB+">AB+</option><option value="AB-">AB-</option></select></div>
                        <div class="input-group"><label for="community">Community</label><select id="community" name="community"><option value="OC">OC</option><option value="BC">BC</option><option value="MBC">MBC</option><option value="SC">SC</option><option value="ST">ST</option></select></div>
                        <div class="input-group"><label for="caste">Caste</label><select id="caste" name="caste"></select></div>
                        <div class="input-group" id="caste-other-group" style="display: none;"><label for="caste_other">Please Specify Caste</label><input type="text" id="caste_other" name="caste_other"></div>
                        <div class="input-group"><label for="religion">Religion</label><select id="religion" name="religion"><option value="Hindu">Hindu</option><option value="Christian">Christian</option><option value="Muslim">Muslim</option><option value="Other">Other</option></select></div>
                        <div class="input-group"><label for="aadhaar_number">Aadhaar Number</label><input type="text" id="aadhaar_number" name="aadhaar_number"></div>
                        <div class="input-group"><label for="permanent_address">Permanent Address</label><textarea id="permanent_address" name="permanent_address"></textarea></div>
                        <div class="input-group"><label for="present_address">Present Address</label><textarea id="present_address" name="present_address"></textarea></div>
                        <div class="input-group radio-group">
                            <label>Are you applying for a scholarship?</label>
                            <div>
                                <input type="radio" id="scholarship-yes" name="has_scholarship" value="yes"> <label for="scholarship-yes">Yes</label>
                                <input type="radio" id="scholarship-no" name="has_scholarship" value="no" checked> <label for="scholarship-no">No</label>
                            </div>
                        </div>
                    </div>
                    <h3>Parent & Contact Details</h3>
                    <div class="form-grid">
                        <div class="input-group"><label for="student_mobile">Student Mobile</label><input type="tel" id="student_mobile" name="student_mobile"></div>
                        <div class="input-group"><label for="father_name">Father's Name</label><input type="text" id="father_name" name="father_name"></div>
                        <div class="input-group"><label for="father_occupation">Father's Occupation</label><input type="text" id="father_occupation" name="father_occupation"></div>
                        <div class="input-group"><label for="father_mobile">Father's Mobile</label><input type="tel" id="father_mobile" name="father_mobile"></div>
                        <div class="input-group"><label for="mother_name">Mother's Name</label><input type="text" id="mother_name" name="mother_name"></div>
                        <div class="input-group"><label for="mother_occupation">Mother's Occupation</label><input type="text" id="mother_occupation" name="mother_occupation"></div>
                        <div class="input-group"><label for="mother_mobile">Mother's Mobile</label><input type="tel" id="mother_mobile" name="mother_mobile"></div>
                        <div class="input-group"><label for="parent_annual_income">Parent's Annual Income</label><input type="number" id="parent_annual_income" name="parent_annual_income"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header"><h2>Academic Details</h2></div>
                <div class="accordion-content">
                    <div class="input-group">
                        <label for="program_level">Current Program Level</label>
                        <select id="program_level" name="program_level">
                            <option value="">-- Select Program --</option>
                            <option value="UG">Undergraduate</option>
                            <option value="PG">Postgraduate</option>
                            <option value="PHD">PhD</option>
                        </select>
                    </div>
                    <div id="ug-entry-type-section" class="conditional-section">
                        <div class="input-group">
                            <label for="ug_entry_type">UG Entry Type</label>
                            <select id="ug_entry_type" name="ug_entry_type">
                                <option value="">-- Select Entry Type --</option>
                                <option value="Regular">Regular (HSC)</option>
                                <option value="Lateral">Lateral (Diploma)</option>
                                <option value="Rejoin">Rejoin</option>
                            </select>
                        </div>
                    </div>
                    <div id="sslc-details-section" class="conditional-section">
                        <h3>SSLC Details</h3>
                        <div class="form-grid">
                            <div class="input-group"><label>SSLC School Name</label><input type="text" name="sslc_school_name"></div>
                            <div class="input-group"><label>SSLC School Address</label><textarea name="sslc_school_address"></textarea></div>
                            <div class="input-group"><label>SSLC Register Number</label><input type="text" name="sslc_register_number"></div>
                            <div class="input-group"><label>SSLC Overall Percentage</label><input type="number" step="0.01" min="0" max="100" name="sslc_percentage"></div>
                            <div class="input-group"><label>SSLC Year of Passing</label><select name="sslc_year_of_passing" class="year-picker"></select></div>
                        </div>
                    </div>
                    <div id="hsc-details-section" class="conditional-section">
                        <h3>HSC Details</h3>
                        <div class="form-grid">
                            <div class="input-group"><label>HSC School Name</label><input type="text" name="hsc_school_name"></div>
                            <div class="input-group"><label>HSC School Address</label><textarea name="hsc_school_address"></textarea></div>
                            <div class="input-group"><label>HSC Register Number</label><input type="text" name="hsc_register_number"></div>
                            <div class="input-group"><label>HSC Overall Percentage</label><input type="number" step="0.01" min="0" max="100" name="hsc_percentage"></div>
                            <div class="input-group"><label>HSC Year of Passing</label><select name="hsc_year_of_passing" class="year-picker"></select></div>
                        </div>
                    </div>
                    <div id="diploma-details-section" class="conditional-section">
                        <h3>Diploma Details</h3>
                        <div class="form-grid">
                            <div class="input-group"><label>Diploma College Name</label><input type="text" name="diploma_college_name"></div>
                            <div class="input-group"><label>Diploma College Address</label><textarea name="diploma_college_address"></textarea></div>
                            <div class="input-group"><label>Diploma Register Number</label><input type="text" name="diploma_register_number"></div>
                            <div class="input-group"><label>Diploma Overall Percentage</label><input type="number" step="0.01" min="0" max="100" name="diploma_percentage"></div>
                            <div class="input-group"><label>Diploma Year of Passing</label><select name="diploma_year_of_passing" class="year-picker"></select></div>
                        </div>
                    </div>
                    <div id="ug-details-section" class="conditional-section"><h3>UG Details</h3><div class="form-grid"><div class="input-group"><label>UG Course</label><input type="text" name="ug_course"></div><div class="input-group"><label>UG University</label><input type="text" name="ug_university"></div><div class="input-group"><label>UG OGPA (out of 100)</label><input type="number" step="0.01" min="0" max="100" name="ug_ogpa"></div><div class="input-group"><label>UG Year of Passing</label><select name="ug_year_of_passing" class="year-picker"></select></div></div></div>
                    <div id="pg-details-section" class="conditional-section"><h3>PG Details</h3><div class="form-grid"><div class="input-group"><label>PG Course</label><input type="text" name="pg_course"></div><div class="input-group"><label>PG University</label><input type="text" name="pg_university"></div><div class="input-group"><label>PG OGPA (out of 100)</label><input type="number" step="0.01" min="0" max="100" name="pg_ogpa"></div><div class="input-group"><label>PG Year of Passing</label><select name="pg_year_of_passing" class="year-picker"></select></div></div></div>
                    <div id="phd-details-section" class="conditional-section"><h3>PhD Details</h3><div class="form-grid"><div class="input-group"><label>PhD Specialization</label><input type="text" name="phd_specialization"></div><div class="input-group"><label>PhD University</label><input type="text" name="phd_university"></div><div class="input-group"><label>PhD Year of Joining</label><select name="phd_year_of_joining" class="year-picker"></select></div></div></div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header"><h2>Bank Details</h2></div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group"><label for="account_holder_name">Account Holder's Name</label><input type="text" id="account_holder_name" name="account_holder_name"></div>
                        <div class="input-group"><label for="account_number">Account Number</label><input type="text" id="account_number" name="account_number"></div>
                        <div class="input-group"><label for="bank_name">Bank Name</label><input type="text" id="bank_name" name="bank_name"></div>
                        <div class="input-group"><label for="branch_name">Branch Name</label><input type="text" id="branch_name" name="branch_name"></div>
                        <div class="input-group"><label for="ifsc_code">IFSC Code</label><input type="text" id="ifsc_code" name="ifsc_code"></div>
                    </div>
                </div>
            </div>
            
            <div id="scholarship-accordion-item" class="accordion-item">
                <div class="accordion-header"><h2>Scholarship Details</h2></div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group"><div class="checkbox-group"><label>First Graduate</label><input type="checkbox" id="is_first_graduate_sch" name="is_first_graduate"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>BC/MBC</label><input type="checkbox" name="sch_bcmbc"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Post Metric</label><input type="checkbox" name="sch_postmetric"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Prime Minister Scheme</label><input type="checkbox" name="sch_pm"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Govt 7.5%</label><input type="checkbox" name="sch_govt"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Pudhumai Penn</label><input type="checkbox" name="sch_pudhumai"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Tamizh Pudhalvan</label><input type="checkbox" name="sch_tamizh"></div></div>
                        <div class="input-group"><div class="checkbox-group"><label>Private Scholarship</label><input type="checkbox" id="sch_private" name="sch_private"></div></div>
                    </div>
                    <div id="private-scholarship-name-section" class="conditional-section">
                         <div class="input-group"><label for="private_scholarship_name">Private Scholarship Name</label><input type="text" id="private_scholarship_name" name="private_scholarship_name"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header"><h2>Document Uploads</h2></div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group"><label for="student_photo">Student Photo</label><input type="file" id="student_photo" name="student_photo"></div>
                        <div class="input-group"><label for="student_id_card">Student ID Card</label><input type="file" id="student_id_card" name="student_id_card"></div>
                        <div class="input-group"><label for="community_certificate">Community Certificate</label><input type="file" id="community_certificate" name="community_certificate"></div>
                        <div class="input-group"><label for="aadhaar_card">Aadhaar Card</label><input type="file" id="aadhaar_card" name="aadhaar_card"></div>
                        <div class="input-group"><label for="sslc_marksheet">SSLC Marksheet</label><input type="file" id="sslc_marksheet" name="sslc_marksheet"></div>
                        <div class="input-group"><label for="hsc_marksheet">HSC Marksheet</label><input type="file" id="hsc_marksheet" name="hsc_marksheet"></div>
                        <div class="input-group"><label for="income_certificate">Income Certificate</label><input type="file" id="income_certificate" name="income_certificate"></div>
                        <div class="input-group"><label for="bank_passbook">Bank Passbook</label><input type="file" id="bank_passbook" name="bank_passbook"></div>
                        <div class="input-group"><label for="driving_license">Driving License</label><input type="file" id="driving_license" name="driving_license"></div>
                        <div id="fg-cert-upload-section" class="input-group conditional-section"><label for="first_graduate_certificate">First Graduate Certificate</label><input type="file" id="first_graduate_certificate" name="first_graduate_certificate"></div>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header"><h2>Other Details</h2></div>
                <div class="accordion-content">
                    <div class="form-grid">
                        <div class="input-group"><label for="ambition">Ambition</label><input type="text" id="ambition" name="ambition"></div>
                        <div class="input-group"><label for="role_model">Role Model</label><input type="text" id="role_model" name="role_model"></div>
                        <div class="input-group"><label for="hobbies">Hobbies</label><textarea id="hobbies" name="hobbies"></textarea></div>
                        <div class="input-group"><label for="identification_marks">Identification Marks</label><textarea id="identification_marks" name="identification_marks"></textarea></div>
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">Submit Registration</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
        
            // --- Function to recalculate accordion height ---
            function updateActiveAccordionHeight() {
                const activeItem = document.querySelector('.accordion-item.active');
                if (activeItem) {
                    const content = activeItem.querySelector('.accordion-content');
                    setTimeout(() => {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }, 50);
                }
            }

            // --- 1. ACCORDION LOGIC ---
            const accordionItems = document.querySelectorAll('.accordion-item');
            if (accordionItems.length > 0) {
                const firstItem = accordionItems[0];
                firstItem.classList.add('active');
                const firstContent = firstItem.querySelector('.accordion-content');
                if (firstContent) {
                    firstContent.style.maxHeight = firstContent.scrollHeight + "px";
                }
            }
            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                if (header) {
                    header.addEventListener('click', () => {
                        const content = item.querySelector('.accordion-content');
                        if (item.classList.contains('active')) {
                            item.classList.remove('active');
                            content.style.maxHeight = '0px';
                        } else {
                            document.querySelectorAll('.accordion-item.active').forEach(openItem => {
                                openItem.classList.remove('active');
                                openItem.querySelector('.accordion-content').style.maxHeight = '0px';
                            });
                            item.classList.add('active');
                            content.style.maxHeight = content.scrollHeight + "px";
                        }
                    });
                }
            });

            // --- 2. YEAR PICKER LOGIC ---
            document.querySelectorAll('.year-picker').forEach(dropdown => {
                const currentYear = new Date().getFullYear();
                const startYear = currentYear - 40;
                const placeholder = document.createElement('option');
                placeholder.value = "";
                placeholder.textContent = "-- Select Year --";
                dropdown.appendChild(placeholder);
                for (let year = currentYear; year >= startYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    dropdown.appendChild(option);
                }
            });

            // --- 3. DEPENDENT CASTE DROPDOWN LOGIC ---
const subCasteData = {
    'ST': [
        "Adiyan", "Aranadan", "Eravallan", "Irular", "Kadar", 
        "Kammar (excluding Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Kanikaran, Kanikkar (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Kaniyan, Kanyan", "Kattunayakan", "Kochu Velan", "Konda Kapus", "Kondareddis", 
        "Koraga", "Kota (excluding Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Kudiya, Melakudi", "Kurichchan", "Kurumbas (in the Nilgiris District)", "Kurumans", 
        "Maha Malasar", "Malai Arayan", "Malai Pandaram", "Malai Vedan", "Malakkuravan", 
        "Malasar", "Malayali (in Dharmapuri, North Arcot, Pudukkottai, Salem, South Arcot and Tiruchirapalli Districts)", 
        "Malayakandi", "Mannan", "Mudugar, Mudvan", "Muthuvan", "Pallayan", "Palliyan", 
        "Palliyar", "Paniyan", "Sholaga", 
        "Toda (excluding Kanyakamari District and Shenlottah Taluk of Tirunelveli District)", "Uraly"
    ],
    'SC': [
        "Adi Dravida", "Adi Karnataka", "Ajila", 
        "Ayyanavar (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Baira", 
        "Bakuda", "Bandi", "Bellara", 
        "Bharatar (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Chalavadi", 
        "Chamar, Muchi", "Chandala", "Cheruman", 
        "Devendrakula Velalar [Devendrakulathan, Kadaiyan(excluding in the coastal areas of Tirunelveli, Thoothukudi, Ramanathapuram, pudukottai, Thanjavur, Tiruvarur and Nagapattinam districts), kalladi, Kudumban, Pallan, pannadi, Vathiriyan]", 
        "Dom, Dombar, Paidi, Pano", "Domban", "Godagali", "Godda", "Gosargi", "Holeya", "Jaggali", 
        "Jambuvulu", "Kadaiyan (in the districts of Tirunelveli, Thoothukudi, Ramanathapuram, Pudukottai, Thanjavur, Tiruvarur and Nagapattinam)", 
        "Kakkalan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Kanakkan, Padanna (in the Nilgiris District)", "Karimpalan", 
        "Kavara (in Kanyakumari District and Shenkottah, Taluk of Tirunelveli District)", "Koliyan", "Koosa", 
        "Kootan, Koodan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Kuravan, Sidhanar", "Maila", "Mala", 
        "Mannan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Mavilan", "Moger", 
        "Mundala", "Nalakeyava", "Nayadi", 
        "Padannan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Palluvan", 
        "Pambada", "Panan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Panchama", 
        "Panniandi", "Paraiyan, Parayan,Sambavar", 
        "Paravan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Pathiyan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Pulayan,Cheramar", 
        "PuthiraiVannan", "Raneyar", "Samagara", "Samban", "Sapari", "Semman", 
        "Thandan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Tiruvalluvar", 
        "Vallon", "Valluvan", "Vannan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", 
        "Velan", "Vetan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Vettiyan", 
        "Vettuvan (in Kanyakumari District and Shenkottah Taluk of Tirunelveli District)", "Madiga"
    ],
    'SCA': [
        "AdiAndhra", "Arunthathiyar", "Chakkiliyan", "Madari", "Madiga", "Pagadai", "Thoti"
    ],
    'MBC': [
        "Ambalakarar", "Andipandaram", "Arayar (in Kanyakumari District)", "Bestha, Siviar", 
        "Bhatraju (Other than Kshatriya Raju)", "Boyar, Oddar", "Dasari", "Dommara", 
        "Eravallar(except in Kanyakumari District and Shenkottah Taluk of Tirunelveli District Wherethe Community is a Scheduled Tribe)", 
        "Isaivellalar", "Jambuvanodai", "Jangam", "Jogi", 
        "Kongu Chettia ( in Coimbatore and Erode Districts only)", "Koracha", 
        "Kulala (including Kuyavar and Kumbarar)", "Kulnnuvar Mannadi", "Kurumba, Kurumba Gounder", 
        "Kuruhini Chetty", "Latin Catholic Christian Vannar (in Kanyakumari District)", 
        "Maruthuvar, Navithar, Mangala, Velakattalavar, Velakatalanair and Pronopakari", 
        "Mond Golla", "Moundadan Chetty", "Mahendra, Medara", "Narikoravar (Kurivikars)", "Nokkar", 
        "A Panisaivan / Panisivan", 
        "Vanniakula Kshatriya (including Vanniyar, Vanniya, Vannia Gounder, Gounder or Kander, Padayachi, Palli & Agnikula Kshatriya)", 
        "Paravar (except in Kanyakumari District and Shenkottah Taluk of Tirunelveli District where the Community is Scheduled Caste)", 
        "Paravar converts to Christianity including the Paravar converts to Christianity of Kanyakumari District and Shenkottah Taluk in Tirunelveli District)", 
        "Meenavar(Parvatharajakulam, Pattanavar, Sembadavar) (including converts to Christianity)", 
        "Mukkuvar or Mukayar (including converts to Christianity)", "Punnan Vettuva Gounder", 
        "Pannayar(other than Kathikarar in Kanyakumari District)", 
        "Sathatha Srivaishnava (including Sathani, Chattadi and Chattada Srivaishnava)", "Sozhia Chetty", 
        "Telugupatty Chetty", 
        "Thotti Naicker (including Rajakambalam, Gollavar, Sillavar, Thockalavar, Thozhuva Naicker and Erragollar)", 
        "Thondaman", "Thoraiyar(Nilgiris)", "Thoraiyar(Plains)", 
        "Transgender or Eunuch (Thirunangai or Aravani)", "Valaiyar(including Chettinad Valayars)", 
        "Vannar (Salaivai Thozhilalar) (including Agasa, Madivala, Ekali, Rajakula, Veluthadar & Rajaka) (except in Kanyakumari District and Shenkottah Taluk of Titunelveli District where the Community is a Scheduled Caste)", 
        "Vettaikarar", "Vettuva Gounder", "Yogeeswarar", 
        "Attur Kilnad Koravars (Salem, Namakkal, Cuddalore, Villupuram, Ramanathapuram, Sivaganga and Virudhunagar Districts)", 
        "Attur Melnad Koravars (Salem and Namakkal District)", 
        "Appanad Kondayam Kottai Maravar (Sivaganga, Virudhunagar, Ramanathapuram, Madurai, Theni and Dindigul Districts)", 
        "Ambalakarar (Thanjavur, Nagapattinam, Tiruvarur, Tiruchirappalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Ambalakkarar (Suriyanur, Tiruchirapalli District)", 
        "Boyas (Tiruchirapalli, Karur, Perambalur, Pudukkottai, The Nilgiris, Salem, Namakkal, Dharmapuri and Krishnagiri Districts)", 
        "Battu Turkas", "C K Koravars (Cuddalore and Villupuram Districts)", 
        "Chakkala(Sivaganga, Virudhunagar, Ramanathapuram, Thanjavur, Nagapattinam,Thiruvarur, Pudukkottai, Tiruchirapalli, Karur, Perambalur, Madurai, Theni, Dindigul and the Nilgiris Districts)", 
        "Changyampudi Koravars (vellore and Thiruvannamalai Districts)", 
        "Chettinad Valayars (Sivaganga,Virudhunagar and Ramanathapuram Districts)", 
        "Dombs (Pudukkottai, Tiruchirapalli, Karur and Perambalur Districts)", 
        "Dobba Koravars (Salem and Namakkal Districts)", 
        "Dommars (Thanjavur, Nagapattinam, Thiruvarur, Pudukkottai, Vellore and Thiruvannamalai Districts)", 
        "Donga Boya", "Donga Ur Korachas", "Devagudi Talayaris", 
        "Dobbai Korachas (Tiruchirapalli, Karur Perambalur and Pudukkottai Districts)", 
        "Dabi Koravars (Thanjavur, Nagapattinam, Thiruvarur, Tiruchirapalli, Karur, Perambalur, Pudukkottai, Vellore and Thiruvannamalai Districts)", 
        "Donga Dasaris (Kancheepuram, Tiruvallur, Tiruchirapalli, Karur, Perambalur, Pudukkottai, Chennai, Salem and Namakkal Districts)", 
        "Gorrela Dodda Boya", "Gudu Dasaris", 
        "Gandarvakottai Koravars (Thanjavur, Nagapattinam, Thiruvarur, Tiruchirapalli, Karur, Perambalur, Pudukkottai, Cuddalore and Villupuram Districts)", 
        "Gandarvakottai Kallars (Thanjavur, Nagapattinam, Thiruvarur and Pudukkotttai Districts)", 
        "Inji Koravars (Thanjavur, Nagapattinam, Thiruvarur, Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Jogis (Kancheepuram, Tiruvallur, Chennai, Cuddalore, Villupuram, Vellore and Thiruvannamalai Districts)", 
        "Jambavanodai", 
        "Kaladis (Sivaganga, Virudhunagar, Ramanathapuram, Madurai, Theni, Dindigul, Thanjavur, Nagapattinam, Thiruvarur, Pudukkottai, Tiruchirapalli, Karur and Perambalur Districts)", 
        "Kal Oddars (Kancheepuram, Thiruvallur, Ramanathapuram, Sivaganga, Virudhunagar, Madurai, Theni Dindigul, Pudukkottai, Thanjavur, Nagapattinam, Tiruvarur, Tiruchirapalli, Karur, Perambalur, Tirunelveli, Thoothukudi, Salem and Namakkal Districts)", 
        "Koravars (Kancheepuram Tiruvallur, Ramanathapuram, Sivaganga, Virudhunagar, Pudukkottai, Thanjavur, Nagapattinam, Thiruvarur,Tiruchirapalli, Karur, Perambalur, Tirunelveli, Thoothukudi, Chennai, Madurai, Theni, Dindigul and The Nilgiris Districts)", 
        "Kalinji Dabikoravars (Thanjavur, Nagapattinam, Tiruvarur and Pudukkottai Districts)", 
        "Kootappal Kalllars (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Kala Koravars (Thanjavur, Nagapattinam, Thiruvarur, Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Kalavathila Boyas", 
        "Kepmaris (Kancheepuram, Tiruvallur, Pudukkottai, Tiruchirapalli, Karur and Perambalur Districts)", 
        "Maravars (Thanjavur, Nagapattinam, Thiruvarur, Pudukkottai, Ramanathapuram, Sivaganga, Virudhunagar, Tirunelveli and Thoothukudi Districts)", 
        "Monda Koravars", "Monda Golla (Salem and Namakkal Districts)", 
        "Mutlakampatti (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Nokkars (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Nellorepet Oddars ( Vellore and Thiruvannamalai Districts)", 
        "Oddars (Thanjavur Nagapattinam Thiruvarur Tiruchirapalli, Karur, Perambalur, Pudukkottai, Madurai, Theni and Dindigul Districts)", 
        "Pedda Boyas (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Ponnai Koravars (Vellore and Thiruvannamalai Districts)", 
        "Piramalai Kallars (Sivagangai, Virudhunagar, Ramanathapuram, Madurai, Theni, Dindigul, Pudukkottai, Thanjavur, Nagapattinam and Thiruvarur Districts)", 
        "Peria Suriyur Kallars(Tiruchirapalli, Karur, Perambalur, and Pudukkottai Districts)", 
        "Padayachi (Vellayan Kuppam in Cuddalore District and Tennore in Tiruchirapalli District)", 
        "Punnan Vettuva Gounder(Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Servai (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Salem Melnad Koravars (Madurai, Theni, Dindigul, Coimbatore, Erode, Pudukkottai, Tiruchirapalli, Karur, Perambalur, Salem, Namakkal, Vellore and Thiruvannamalai Districts)", 
        "Salem Uppu Koravars (Salem & Namakkal Districts)", 
        "Sakkaraithamadai Koravars (Vellore and Thiruvannamalai Districts)", 
        "Saranga Palli Koravars", "Sooramari Oddars (Salem and Namakkal Districts)", 
        "Sembanad Maravars (Sivaganga, Virudhunagar and Ramanathapuram Districts)", 
        "Thalli Koravars (Salem and Namakkal Districts)", 
        "Telungapatti Chetis (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Thottia Naickers (Sivaganga, Virudhunagar, Ramanathapuram, Kancheepuram, Tiruvallur, Thanjavur, Nagapattinam, Thiruvarur, Tiruchirapalli, Karur, Perambalur, Pudukkottai,Tirunelveli, Thoothukudi, Salem, Namakkal, Vellore, Thiruvannamalai, Coimbatore Erode & Districts)", 
        "Thogamalai Koravars or Kepmaris (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Uppukoravars or Settipalli Koravars (Thanjavur, Nagapattinam, Thiruvarur, Pudukkottai, Madurai, Theni, Dindigu, Vellore and Thiruvannamalai Districts)", 
        "Urali Gounders (Tiruchirapalli, Karur, Perambalur, Ariyalur and Pudukkottai Districts)", 
        "Wayalpad or Nawalpeta Korachas", 
        "Vaduvarpatti Koravars (Madurai, Theni, Dindigul, Ramanathapuram, Sivaganga, Virudhunagar, Tirunelveli, Thoothukudi, Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Valayars (Madurai, Theni, Dindigul, Tiruchirapalli, Karur, Perambalur, pudukkottai, Erode and Coimbatore Districts)", 
        "Vettaikarar (Thanjavur, Nagapattinam, Thiruvarur and Pudukkottai Districts)", 
        "Vetta koravars (Salem and Namakkal Districts)", 
        "Varaganeri Koravars (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)", 
        "Vettuva Gounder (Tiruchirapalli, Karur, Perambalur and Pudukkottai Districts)"
    ],
    'BC': [
        "Agamudayar including Thozhu or Thuluva Vellala", "Agaram Vellan Chettiar", 
        "Alwar, Azhavar and Alavar (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", 
        "Servai(except Tiruchirapalli, Karur, Perambalur and Pudukottai Districts )", 
        "Nulayar(in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Archakarai Vellala", 
        "Aryavathi(in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Ayira Vaisyar", 
        "Badagar", "Billava", "Bondil", 
        "Boyas (except Tiruchirapalli, Karur, Perambalur, Pudukottai, The Nilgiris, Salem ,Namakkal Dharmapuri and Krishnagiri Districts), Pedda Boyar (except Tiruchirapalli, Karur , Perambalur and Pudukottai Districts), Oddars (except Thanjavur, Nagapattinam, Districts), Kaloddars (except Kancheepuram, Tiruvallur, Ranathapuram, Sivaganga, Viruthunagar, Madurai, Theni, Dindigul, Purdukkottai, Tiruchirappalli, Karur, Perambalur, Tirunelveli, Thoothukudi, Salam and Namakkal Districts), Nellorepet oddars (except Vellore and Tiruvannamalai Districts) Sooramari oddars( except Salem and Namakkal Districts)Pudukottai, Madurai, Theni and Dindigul Tiruchirapalli, Karur, Perambalur,Tiruvarur,", 
        "Chakkala (except Sivaganga, Virudhunagar, Ramanathapuram, Thanjavur, Nagapattinam,Tiruvarur, Pudukottai, Tiruchirapalli, Karur, Perambalur, Madurai, Theni, Dindigul and the Nilgiris Districts)", 
        "Chavalakarar (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Chettu or Chetty (including Kottar Chetty, Elur Chetty, Pathira Chetty, Valayal Chetty,Pudukadai Chetty ) ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Chowdry", 
        "Converts to Christianity from Scheduled Castes irrespective of the generation of conversion for the purpose of reservation of seats in Educational Institutions and for seats in Public Services", 
        "C S I formerly S I U C (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Donga Dasaris ( except Kancheepuram, Tiruvallur, Trichirapalli, Karur, Parambalur, Pudukottai, Chennai, Salem and Namakkal Districts", 
        "Devangar, Sedar", "Dombs (except Pudukottai, Tiruchirapalli, Karur and Perambalur Districts)", 
        "Dommars (except Thanjavur, Nagapattinam,Tiruvarur, Pudukottai,Vellore and Thiruvannamalai Districts)", 
        "Enadi", "Ezhavathy(in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Ezhuthachar (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Ezhuva(in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Gangavar", 
        "Gavara, Gavarai and Vadugar (Vaduvar) (other than Kamma, Kapu, Balija and Reddi)", "Gounder", 
        "Gowda (including Gammala, Kalali and Anuppa Gounder)", "Hegde", "Idiga", 
        "IllathuPillaimar, Illuvar, Ezhuvar and Illathar", "Jhetty", 
        "Jogis (Except Kancheepuram, Tiruvallur, Madurai, Theni, Dindigul, Cuddalore, Villupuram, Vellore and Tiruvannamalai Districts)", 
        "Kabbera", "Kaikolar, Sengunthar", 
        "Kaladi (except Sivaganga, Virudhunagar, Ramanathapuram, Madurai, Theni, Dindigul,Thanjavur, Nagapattinam,Tiruvarur, Pudukottai, Tiruchirapalli, Karur and Perambalur Districts)", 
        "Kalari Kurup including Kalari Panicker (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", 
        "Kalingi", 
        "Kallar, Easanattu Kallar, Gandharva Kottai Kallars(except Thanjavur, Nagapattinam, Tiruvarur and Pudukottai Districts), Kootappal Kallars-(except Pudukottai, Tiruchirapalli, Karur and Perambalur Districts), Piramalai Kallars- (except Sivaganga,Virudhunagar, Ramanathapuram Madurai Theni, Dindigul, Nagapattinam and Tiruvarur Districts) Pudukottai, Thanjavur, Periyasooriyur Kallars- (except Tiruchirapalli, Karur, Perambalur and Pudukottai Districts)", 
        "Kallar Kula Thondaman", "Kalveli Gounder", "Kambar", 
        "Kammalar or Viswakarma , Viswakarmala (including Thattar, Porkollar, Kannar, Karumar, Kollar, Thacher, Kal Thacher, Kamsala and Viswa brahmin )", 
        "Kani, Kanisu, Kaniyar Panicker", "Kaniyala Vellalar", 
        "Kannada Saineegar ,Kannadiyar (Throughout the State) and Dasapalanjika (Coimbatore, Erode and the Nilgiris Districts)", 
        "Kannadiya Naidu", "Karpoora Chettiar", 
        "Karuneegar (Seer Karuneegar, Sri Karuneegar, Sarattu Karuneegar, Kaikatti Karuneegar, Mathuvazhi Kanakkar, Sozhi Kanakkar, and Sunnambu Karuneegar)", 
        "Kasukkara Chettiar", "Katesar, Pattamkatti", "Kavuthiyar", "Kerala Mudali", "Kharvi", "Khatri", 
        "Kongu Vaishnava", 
        "Kongu Vellalars( including Vellala Gounder, Nattu Gounder, Narambukkatti Gounder, Tirumudi Vellalar, Thondu Vellalar, Pala Gounder, Poosari Gounder, Anuppa Vellala Gounder, Padaithalai Gounder, Chendalai Gounder, Pavalankatti Vellala Gounder,Palavellala Gounder, Sanku Vellala Gounder and Rathinagiri Gounder)", 
        "KoppalaVelama", "Koteyar", 
        "Krishnanvaka (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Kudikara Vellalar", 
        "Kudumbi ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Kuga Vellalar", 
        "Kunchidigar", "Latin Catholics except Latin Catholic Vannar in Kanniyakumari District", 
        "Lathin Catholics in Shencottah Taluk of Tirunelveli District", "Lambadi", "Lingayat (Jangama)", 
        "Mahratta (Non-Brahmin) (including Namdev Mahratta)", "Malayar", "Male", "Maniagar", 
        "Maravars (except Thanjavur, Nagapattinum, Tiruvarur, Pudukottai, Ramanathapuram, Sivaganga, Virudhunagar, Tirunelveli and Toothukudi Districts), Karumaravars Appanad Kondayam kottai Maravar ?(except Sivaganga, Virudhunagar, Ramanathapuram, Madurai, Theni and Dindigul Districts ) Sembanad Maravars- (except Sivaganga, Virudhunagar, and Ramanathapuram Districts)", 
        "Moondrumandai Enbathunalu ( ) Ur Sozhia Vellalar", "Mooppan", "Muthuraja, Muthuracha, Muttiriyar, Mutharaiyar", 
        "Nadar, Shanar and Gramani", "Nagaram", 
        "Naikkar (in Kanniyakumari District and Shencottah Taluk of Tirunelveli District)", "Nangudi Vellalar", 
        "Nanjil Mudali ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", 
        "Odar ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", "Odiya", 
        "Oottruvalanattu Vellalar", "O P S Vellalar", "Ovachar", "Paiyur Kotta Vellalar", "Pamulu", 
        "Panar ( except in Kanniyakumari District and Shencottah Taluk of Tirunelveli District where the community is a Scheduled Caste )", 
        "Pandiya Vellalar", "Kathikarar in Kanniyakumari District", 
        "Pannirandam Chettiar or Uthama Chettiar", 
        "Parkavakulam ( including Surithimar, Nathamar, Malayamar, Moopanar and Nainar )", 
        "Perike ( including Perike Balija )", 
        "Perumkollar ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", "Podikara Vellalar", 
        "Pooluva Gounder", "Poraya", "Pulavar ( in Coimbatore and Erode Districts )", "Pulluvar or Pooluvar", 
        "Pusala", "Reddy ( Ganjam )", "Sadhu Chetty ( including Telugu Chetty, Twenty four Manai Telugu Chetty)", 
        "Sakkaravar or Kavathi ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", "Salivagana", 
        "Saliyar, Padmasaliyar, Pattusaliyar, Pattariyar, and Adhaviyar", "Savalakkarar", 
        "Senaithalaivar, Senaikudiyar and Illaivaniar", "Serakula Vellalar", "Sourashtra ( Patnulkarar )", 
        "Sozhiavellalar ( including Sozha Vellalar, Vetrilaikarar, Kodikalkarar and Keeraikarar )", "Srisayar", 
        "Sundaram Chetty", "Thogatta Veerakshatriya", 
        "Tholkollar ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", 
        "Tholuva Naicker and Vetalakara Naicker", "Thoraiyar", "Thoriyar", "Ukkirakula Kshatriya Naicker", 
        "Uppara, Uppillia and Sagara", 
        "Urali Gounder ( except Tiruchirapalli, Karur, Perambalur and Pudukottai District) and Orudaya Gounder or Oorudaya Gounder ( in Madurai ,Theni, Dindigul, Coimbatore, Erode, Tiruchirapalli, Karur , Perambalur, Pudukottai, Salem and Namakkal Districts )", 
        "Urikkara Nayakkar", "Virakodi Vellala", "Vallambar", "Vallanattu Chettiar", "Valmiki", 
        "Vaniyar, Vania Chettiar ( including Gandla, Ganika, Telikula and Chekkalar)", 
        "Veduvar and Vedar ( except in Kanniyakumari District and Shencottah Taluk of Tirunelveli District where the community is a Scheduled Castes)", 
        "Veerasaiva ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", "Velar", 
        "Vellan Chettiar", 
        "Veluthodathu Nair ( in Kanniyakumari District and Shencottah Taluk of Tirunelveli District )", 
        "Vokkaligar ( including Vakkaligar, Okkaligar, Kappiliyar, Kappiliya, Okkaliga Gowda, Okkaliya- Gowda, Okkaliya- Gowder, Okkaliya Gowda )", 
        "Wynad Chetty ( The Nilgiris District )", 
        "Yadhava ( including Idaiyar, Telugu Speaking Idaiyar known as Vaduga Ayar or Vaduga Idaiyar or Golla and Asthanthra Golla)", 
        "Yavana", "Yerukula", 
        "Orphans and destitute children who have lost their parents before reaching the age of ten and are destitutes; and who have nobody else to take care of them either by law or custom; and also who are admitted into any of the schools or orphanages run by the Government or recognized by the Government", 
        "Thiyya", 
        "Converts to Christianity from any Hindu Backward Classes Community or Most Backward Classes Community or Denotified Communities (except the Converts to Christianity from Meenavar, Parvatharajakulam, Pattanavar, Sembadavar, Mukkuvar or Mukayar and Paravar)",
        "Ansar", "Dekkani Muslims", "Dudekula", "Labbais including Rowthar and Marakayar (whether their spoken language is Tamil or Urdu)", "Mapilla", "Sheik", "Syed", "pattapu"
    ],
    'OC': [
        "Not Applicable"
    ]
};

            const communitySelect = document.getElementById('community');
            const casteSelect = document.getElementById('caste');
            const casteOtherGroup = document.getElementById('caste-other-group');

            function updateCasteOptions() {
                const selectedCommunity = communitySelect.value;
                const castes = subCasteData[selectedCommunity] || [];
                casteSelect.innerHTML = '';
                casteOtherGroup.style.display = 'none';

                if (castes.length === 0) {
                    const defaultOption = document.createElement('option');
                    defaultOption.value = 'Not Applicable';
                    defaultOption.textContent = 'Not Applicable';
                    casteSelect.appendChild(defaultOption);
                } else {
                    const placeholder = document.createElement('option');
                    placeholder.value = '';
                    placeholder.textContent = '-- Select your caste --';
                    casteSelect.appendChild(placeholder);
                    castes.forEach(caste => {
                        const option = document.createElement('option');
                        option.value = caste;
                        option.textContent = caste;
                        casteSelect.appendChild(option);
                    });
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    otherOption.textContent = 'Other (Please specify)';
                    casteSelect.appendChild(otherOption);
                }
            }

            function handleCasteChange() {
                if (casteSelect.value === 'Other') {
                    casteOtherGroup.style.display = 'block';
                } else {
                    casteOtherGroup.style.display = 'none';
                }
                updateActiveAccordionHeight();
            }

            if (communitySelect && casteSelect) {
                communitySelect.addEventListener('change', updateCasteOptions);
                casteSelect.addEventListener('change', handleCasteChange);
                updateCasteOptions();
            }

            // --- 4. CONDITIONAL SECTIONS LOGIC ---
            const programLevelSelect = document.getElementById('program_level');
            const ugEntryTypeSection = document.getElementById('ug-entry-type-section');
            const ugEntryTypeSelect = document.getElementById('ug_entry_type');
            const sslcSection = document.getElementById('sslc-details-section');
            const hscSection = document.getElementById('hsc-details-section');
            const diplomaSection = document.getElementById('diploma-details-section');
            const ugSection = document.getElementById('ug-details-section');
            const pgSection = document.getElementById('pg-details-section');
            const phdSection = document.getElementById('phd-details-section');
            const scholarshipRadios = document.querySelectorAll('input[name="has_scholarship"]');
            const scholarshipAccordion = document.getElementById('scholarship-accordion-item');
            const privateSchCheckbox = document.getElementById('sch_private');
            const privateSchNameSection = document.getElementById('private-scholarship-name-section');
            const fgCheckbox = document.getElementById('is_first_graduate_sch');
            const fgCertUploadSection = document.getElementById('fg-cert-upload-section');

            function handleProgramChange() {
                const level = programLevelSelect.value;
                ugEntryTypeSection.style.display = level === 'UG' ? 'block' : 'none';
                
                // Reset dependent fields when program level changes
                ugEntryTypeSelect.value = '';
                handleEntryTypeChange(); // This will hide HSC/Diploma sections
                
                sslcSection.style.display = 'none'; // Hide SSLC by default
                ugSection.style.display = (level === 'PG' || level === 'PHD') ? 'block' : 'none';
                pgSection.style.display = level === 'PHD' ? 'block' : 'none';
                phdSection.style.display = level === 'PHD' ? 'block' : 'none';
                
                updateActiveAccordionHeight();
            }

            function handleEntryTypeChange() {
                const entryType = ugEntryTypeSelect.value;
                sslcSection.style.display = (entryType === 'Regular' || entryType === 'Lateral') ? 'block' : 'none';
                hscSection.style.display = entryType === 'Regular' ? 'block' : 'none';
                diplomaSection.style.display = entryType === 'Lateral' ? 'block' : 'none';
                updateActiveAccordionHeight();
            }

            function handleScholarshipChange() {
                const wantsScholarship = document.querySelector('input[name="has_scholarship"]:checked').value === 'yes';
                scholarshipAccordion.style.display = wantsScholarship ? 'block' : 'none';
            }

            if (programLevelSelect) programLevelSelect.addEventListener('change', handleProgramChange);
            if (ugEntryTypeSelect) ugEntryTypeSelect.addEventListener('change', handleEntryTypeChange);
            scholarshipRadios.forEach(radio => radio.addEventListener('change', handleScholarshipChange));
            if (privateSchCheckbox) privateSchCheckbox.addEventListener('change', () => { privateSchNameSection.style.display = privateSchCheckbox.checked ? 'block' : 'none'; updateActiveAccordionHeight(); });
            if (fgCheckbox) fgCheckbox.addEventListener('change', () => { fgCertUploadSection.style.display = fgCheckbox.checked ? 'block' : 'none'; updateActiveAccordionHeight(); });

            // Initial setup
            handleScholarshipChange();
            handleProgramChange();
            
            // --- 5. FORM SUBMISSION LOGIC ---
            const form = document.getElementById('registration-form');
            if (form) {
                form.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    if (password !== confirmPassword) {
                        alert("Passwords do not match.");
                        return;
                    }
                    const formData = new FormData(form);
                    try {
                        const response = await fetch("{% url 'api_register_student' %}", {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}' // Important for Django API calls
                            }
                        });
                        const result = await response.json();
                        if (response.ok) {
                            window.location.href = "{% url 'registration_success' %}";
                        } else {
                            alert('Error: ' + result.error);
                        }
                    } catch (error) {
                        console.error('Submission Error:', error);
                        alert('A network error occurred.');
                    }
                });
            }
        });
    </script>
</body>
</html>
