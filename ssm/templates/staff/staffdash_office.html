{% extends 'staff/staffdash_hod.html' %}
<!-- Reusing layout but overriding sidebar and content -->

{% block sidebar %}
<aside class="sidebar">
    <div class="brand">
        <img src="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" alt="Logo">
        <h1>Office Staff</h1>
    </div>

    <nav class="nav-section">
        <div class="nav-label">Menu</div>
        <a href="{% url 'staffs:staff_profile' %}" class="nav-item">
            <span class="nav-icon">ğŸ‘¤</span> My Profile
        </a>
        <a href="{% url 'staffs:office_manage_bonafide' %}" class="nav-item">
            <span class="nav-icon">ğŸ“œ</span> Bonafide Requests
        </a>
        <a href="{% url 'staffs:scholarship_manager' %}" class="nav-item">
            <span class="nav-icon">ğŸ“</span> Scholarship Manager
        </a>
    </nav>

    <div class="profile-mini">
        {% if staff.photo %}
        <img src="{{ staff.photo.url }}" alt="Profile">
        {% else %}
        <img src="https://ui-avatars.com/api/?name={{ staff.name }}" alt="Profile">
        {% endif %}
        <div style="flex: 1; min-width: 0;">
            <div
                style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.9rem;">
                {{ staff.name }}
            </div>
            <div style="font-size: 0.75rem; color: var(--text-muted);">Office Staff</div>
        </div>
        <a href="{% url 'staffs:staff_logout' %}" title="Logout"
            style="color: #ef4444; font-size: 1.1rem; text-decoration: none;">â»</a>
    </div>
</aside>
{% endblock %}

{% block title %}Office Staff Dashboard | {{ staff.name }}{% endblock %}

{% block content %}
<div class="top-bar">
    <div class="greeting" style="display: flex; align-items: center;">
        <button class="menu-toggle-btn" onclick="toggleSidebar()">â˜°</button>
        <div>
            <h2>Hello, {{ staff.name }} ğŸ‘‹</h2>
            <p>Welcome back to your dashboard.</p>
        </div>
    </div>
    <!-- Combined Clock & Date Badge -->
    <div class="clock-badge">
        <span>{% now "l, d F Y" %}</span>
        <span style="opacity: 0.3">|</span>
        <span id="digital-clock" style="font-family: monospace; font-weight: 600;">00:00:00</span>
    </div>
</div>

<div class="dashboard-grid">
    <!-- Activity Section (Left Column) replacing News -->
    <div class="news-section">
        <div class="section-header" style="margin-bottom: 20px;">
            <h3>Recent Bonafide Activity</h3>
            <a href="{% url 'staffs:office_manage_bonafide' %}"
                style="font-size: 0.85rem; color: var(--primary); text-decoration: none; font-weight: 600;">View All</a>
        </div>

        <div
            style="background: white; border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--border);">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border);">
                        <th style="text-align: left; padding: 10px; color: var(--text-muted); font-size: 0.8rem;">
                            Student</th>
                        <th style="text-align: left; padding: 10px; color: var(--text-muted); font-size: 0.8rem;">Reason
                        </th>
                        <th style="text-align: left; padding: 10px; color: var(--text-muted); font-size: 0.8rem;">Status
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in recent_bonafide_requests %}
                    <tr style="border-bottom: 1px solid var(--bg-body);">
                        <td style="padding: 12px 10px;">
                            <div style="font-weight: 600; font-size: 0.9rem; color: var(--text-main);">{{ req.student.student_name }}</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">{{ req.student.roll_number }}</div>
                        </td>
                        <td style="padding: 12px 10px; font-size: 0.85rem; color: var(--text-secondary);">{{ req.reason|truncatechars:25 }}</td>
                        <td style="padding: 12px 10px;">
                            <span style="padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; 
                            {% if req.status == 'Approved' %}background: #dcfce7; color: #166534;
                            {% elif req.status == 'Rejected' %}background: #fee2e2; color: #991b1b;
                            {% else %}background: #e0f2fe; color: #075985;{% endif %}">
                                {{ req.status }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3"
                            style="padding: 20px; text-align: center; color: var(--text-muted); font-style: italic;">No
                            recent activity</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Stats Column (Right Column) -->
    <div class="stats-column">
        <!-- Total Students -->
        <a href="#" class="stat-card" style="text-decoration: none; color: inherit; cursor: default;">
            <div class="stat-icon" style="background: #e0e7ff; color: #4338ca;">ğŸ‘¨â€ğŸ“</div>
            <div class="stat-info">
                <h3>{{ student_count }}</h3>
                <span>Total Students</span>
            </div>
        </a>

        <!-- Bonafide Requests -->
        <a href="{% url 'staffs:office_manage_bonafide' %}" class="stat-card"
            style="text-decoration: none; color: inherit;">
            <div class="stat-icon" style="background: #e0f2fe; color: #0284c7;">ğŸ“œ</div>
            <div class="stat-info">
                <h3>{{ pending_bonafide_count }}</h3>
                <span>Bonafide Requests</span>
            </div>
        </a>

        <!-- Scholarship Manager -->
        <a href="{% url 'staffs:scholarship_manager' %}" class="stat-card"
            style="text-decoration: none; color: inherit;">
            <div class="stat-icon" style="background: #f0fdf4; color: #16a34a;">ğŸ“</div>
            <div class="stat-info">
                <h3>Manage</h3>
                <span>Scholarships</span>
            </div>
        </a>
    </div>
</div>

<!-- Quick Actions Grid -->
<section class="actions-section">
    <div class="section-header">
        <h3>Quick Management</h3>
    </div>
    <div class="actions-grid">
        <a href="{% url 'staffs:staff_profile' %}" class="action-tile">
            <div class="action-tile-icon">ğŸ‘¤</div>
            <h4>My Profile</h4>
            <p>View personal details.</p>
        </a>
        <!-- Bonafide Quick Action Removed -->
        <a href="{% url 'staffs:scholarship_manager' %}" class="action-tile">
            <div class="action-tile-icon">ğŸ’°</div>
            <h4>Scholarships</h4>
            <p>Manage applications.</p>
        </a>
    </div>
</section>
{% endblock %}