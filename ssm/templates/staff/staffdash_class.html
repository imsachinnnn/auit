{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Incharge Dashboard | {{ staff.name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png"
        type="image/png">
    <link rel="stylesheet" href="{% static 'css/staff_dashboard.css' %}">
    <style>
        /* Specific overrides can go here if needed */
    </style>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <img src="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png"
                    alt="Logo">
                <h1>Class<br>Incharge</h1>
            </div>

            <nav class="nav-section">
                <div class="nav-label">Menu</div>
                <!-- <a href="#" class="nav-item active">
                    <span class="nav-icon">ğŸ“Š</span> Dashboard
                </a> -->
                <a href="{% url 'staffs:staff_profile' %}" class="nav-item">
                    <span class="nav-icon">ğŸ‘¤</span> My Profile
                </a>
                <a href="{% url 'staffs:staff_portfolio' %}" class="nav-item">
                    <span class="nav-icon">ğŸ“„</span> Publications & Accomplishments
                </a>
                <a href="{% url 'staffs:risk_students' %}" class="nav-item">
                    <span class="nav-icon">âš ï¸</span> Risk Students
                </a>
                <a href="{% url 'staffs:student_list' %}" class="nav-item">
                    <span class="nav-icon">ğŸ‘¨â€ğŸ“</span> My Students
                </a>
                <a href="{% url 'staffs:remark_student_list' %}" class="nav-item">
                    <span class="nav-icon">ğŸ’¬</span> Student Remarks
                </a>
                <a href="{% url 'staffs:timetable' %}" class="nav-item">
                    <span class="nav-icon">ğŸ—“ï¸</span> My Timetable
                </a>
                <a href="{% url 'staffs:view_leave_requests' %}" class="nav-item">
                    <span class="nav-icon">ğŸ“</span> Review Leaves
                </a>
                <a href="{% url 'staffs:exam_schedule' %}" class="nav-item">
                    <span class="nav-icon">ğŸ“…</span> Exam Duties
                </a>
                <a href="{% url 'staffs:staff_apply_leave' %}" class="nav-item">
                    <span class="nav-icon">âœˆï¸</span> Apply Leave
                </a>
            </nav>

            <div class="profile-mini">
                {% if staff.photo %}
                <img src="{{ staff.photo.url }}" alt="Profile">
                {% else %}
                <img src="https://ui-avatars.com/api/?name={{ staff.name }}" alt="Profile">
                {% endif %}
                <div style="flex: 1; min-width: 0;">
                    <div
                        style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.9rem;">
                        {{ staff.name }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Class Incharge {% if staff.assigned_semester %}{% endif %}</div>
                </div>
                <a href="{% url 'staffs:staff_logout' %}" title="Logout"
                    style="color: #ef4444; font-size: 1.1rem; text-decoration: none;">â»</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <div class="greeting" style="display: flex; align-items: center;">
                    <button class="menu-toggle-btn" onclick="toggleSidebar()">â˜°</button>
                    <div>
                        <h2>Hello, {{ staff.name }} ğŸ‘‹</h2>
                        <p style="font-size: 1.1rem; color: var(--text-muted); margin-top: 4px;">Class Incharge &bull;
                            <b style="color: var(--primary);">Semester {{ staff.assigned_semester }}</b>
                        </p>
                    </div>
                </div>
                <div class="clock-badge">
                    <span>{% now "l, d F Y" %}</span>
                    <span style="opacity: 0.3">|</span>
                    <span id="digital-clock" style="font-family: monospace; font-weight: 600;">00:00:00</span>
                </div>
            </div>

            <!-- Top Grid -->
            <div class="dashboard-grid">
                <!-- News Widget -->
                <div class="news-section">
                    <!-- Clean Include -->
                    {% include 'news_component.html' %}
                </div>

                <!-- Stats Column -->
                <div class="stats-column">
                    <!-- Semester Card (New) -->
                    {% if staff.assigned_semester %}
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #fef3c7; color: #d97706;">ğŸ›ï¸</div>
                        <div class="stat-info">
                            <h3>{{ staff.assigned_semester }}</h3>
                            <span>Current Semester</span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Leave Requests -->
                    <a href="{% url 'staffs:view_leave_requests' %}" class="stat-card"
                        style="text-decoration: none; color: inherit;">
                        {% if pending_leaves_count > 0 %} <div class="pulse-ring"></div> {% endif %}
                        <div class="stat-icon blue">ğŸ“</div>
                        <div class="stat-info">
                            <h3>{{ pending_leaves_count }}</h3>
                            <span>Leave Requests</span>
                        </div>
                    </a>

                    <a href="{% url 'staffs:student_list' %}" class="stat-card"
                        style="text-decoration: none; color: inherit;">
                        <div class="stat-icon" style="background: #e0e7ff; color: #4338ca;">ğŸ‘¨â€ğŸ“</div>
                        <div class="stat-info">
                            <h3>{{ student_count }}</h3>
                            <span>Assigned Students</span>
                        </div>
                    </a>

                    <!-- Attendance Deficit Link -->
                    <a href="{% url 'staffs:attendance_deficit_list' %}" class="stat-card"
                        style="text-decoration: none; color: inherit;">
                        <div class="stat-icon" style="background: #fee2e2; color: #ef4444;">ğŸ“‰</div>
                        <div class="stat-info">
                            <h3>Alerts</h3>
                            <span>Low Attendance</span>
                        </div>
                    </a>
                </div>
            </div>



            <!-- My Teaching Courses Quick Actions -->
            <section class="actions-section">
                <div class="section-header">
                    <h3>My Teaching Courses</h3>
                </div>
                <!-- If no courses, show message, else grid -->
                <div class="actions-grid">
                    {% for subject in subjects %}
                    <div class="action-tile" style="border-left: 4px solid var(--primary);">
                        <div style="display: flex; justify-content: space-between;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span
                                    style="font-size: 0.7rem; background: var(--primary-light); color: var(--primary-dark); padding: 2px 8px; border-radius: 4px;">{{subject.code}}</span>
                                {% if subject.subject_type == 'Lab' %}
                                <span
                                    style="font-size: 0.7rem; background: #e0e7ff; color: #4338ca; padding: 2px 8px; border-radius: 4px; font-weight: 500;">Lab</span>
                                {% endif %}
                            </div>
                            <span style="font-size: 0.7rem; color: var(--text-muted);">Sem {{ subject.semester }}</span>
                        </div>
                        <h4 style="font-size: 0.95rem;">{{ subject.name }}</h4>
                        <!-- Action Buttons inside card -->
                        <div style="display: flex; gap: 8px; margin-top: auto;">
                            <a href="{% url 'staffs:manage_marks' subject.id %}"
                                style="flex: 1; text-align: center; background: var(--bg-body); padding: 8px; border-radius: 6px; font-size: 0.8rem; text-decoration: none; color: var(--text-main); border: 1px solid var(--border);">Marks</a>
                            <a href="{% url 'staffs:manage_attendance' subject.id %}"
                                style="flex: 1; text-align: center; background: var(--primary); padding: 8px; border-radius: 6px; font-size: 0.8rem; text-decoration: none; color: white;">Attendance</a>
                        </div>
                    </div>
                    {% empty %}
                    <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 40px;">
                        No subjects assigned yet.
                    </div>
                    {% endfor %}
                </div>
            </section>
        </main>
    </div>
    <script>
        function updateClock() {
            const now = new Date();
            document.getElementById('digital-clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');

            if (sidebar.style.display === 'flex') {
                sidebar.style.display = '';
                if (overlay) overlay.remove();
            } else {
                sidebar.style.display = 'flex';
                sidebar.style.position = 'fixed';
                sidebar.style.zIndex = '1000';
                sidebar.style.width = '280px';

                // Add overlay
                const newOverlay = document.createElement('div');
                newOverlay.className = 'sidebar-overlay';
                newOverlay.style.position = 'fixed';
                newOverlay.style.top = '0';
                newOverlay.style.left = '0';
                newOverlay.style.right = '0';
                newOverlay.style.bottom = '0';
                newOverlay.style.background = 'rgba(0,0,0,0.5)';
                newOverlay.style.zIndex = '999';
                newOverlay.onclick = toggleSidebar;
                document.body.appendChild(newOverlay);
            }
        }

        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.sidebar-overlay');
                sidebar.style.display = '';
                sidebar.style.position = '';
                if (overlay) overlay.remove();
            }
        });
    </script>
</body>

</html>