{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - {{ student.student_name }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://res.cloudinary.com/deocom5lr/image/upload/v1754117176/annamalai_kuoh1j.png" type="image/png">

    <style>
        :root {
            --primary-bg: #f8f9fa;
            --secondary-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent-color: #5a7d7c;
            --accent-color-hover: #4a6b69;
            --success-bg: #d1e7dd;
            --success-text: #0f5132;
            --success-border: #a3cfbb;
            --info-bg: #cff4fc;
            --info-text: #055160;
            --info-border: #9eeaf9;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-primary); margin: 0; padding: 40px 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .form-header { text-align: center; margin-bottom: 40px; }
        .form-header h1 { font-size: 2.5em; margin: 0; }
        .form-header p { color: var(--text-secondary); font-size: 1.1em; }
        
        .messages { list-style: none; padding: 0; margin-bottom: 20px; }
        .messages li { padding: 15px 20px; border-radius: 8px; margin-bottom: 10px; }
        .messages li.success { 
            background-color: var(--success-bg); 
            color: var(--success-text); 
            border: 1px solid var(--success-border);
            border-left: 4px solid #0f5132;
        }
        .messages li.success strong { display: block; margin-bottom: 5px; font-size: 1.05em; }
        .messages li.success p { margin: 5px 0 0 0; font-size: 0.95em; }

        .info-box {
            background-color: var(--info-bg);
            border: 1px solid var(--info-border);
            border-left: 4px solid var(--info-text);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 25px;
            color: var(--info-text);
        }
        .info-box strong { display: block; margin-bottom: 5px; font-size: 1em; }
        .info-box p { margin: 5px 0 0 0; font-size: 0.9em; line-height: 1.5; }

        .card { background-color: var(--secondary-bg); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 25px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .card-title { font-size: 1.3em; font-weight: 600; margin: 0 0 20px 0; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); color: var(--accent-color); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-grid-full { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); font-size: 0.9em; }
        .input-group input, .input-group textarea { background-color: #fff; border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 1em; width: 100%; box-sizing: border-box; }
        .input-group textarea { min-height: 100px; resize: vertical; }
        
        .document-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .document-upload-item { display: flex; flex-direction: column; gap: 8px; }
        .current-file { font-size: 0.85em; color: var(--text-secondary); margin-top: 5px; }
        .current-file a { color: var(--accent-color); font-weight: 500; text-decoration: none; }
        .current-file a:hover { text-decoration: underline; }
        .not-uploaded { color: #dc3545; font-weight: 500; }

        .button-group { display: flex; gap: 15px; margin-top: 30px; }
        .submit-btn, .cancel-btn { flex: 1; border: none; padding: 15px 30px; font-size: 1.1em; font-weight: 600; border-radius: 6px; cursor: pointer; text-decoration: none; text-align: center; display: inline-block; }
        .submit-btn { background-color: var(--accent-color); color: #ffffff; }
        .submit-btn:hover { background-color: var(--accent-color-hover); }
        .cancel-btn { background-color: var(--secondary-bg); color: var(--text-primary); border: 1px solid var(--border-color); }

        @media (max-width: 768px) {
            .form-grid, .document-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <img src="{% static 'imgs/aublack.png' %}" alt="University Logo" width="200" height="auto"/>
            <h1>Edit Your Profile</h1>
            <p>Update your contact information, bank details, and documents</p>
        </div>
{% comment %} 
        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li class="{{ message.tags }}">
                <strong>Profile Updated Successfully!</strong>
                <p>Your changes have been saved. If you need to update other information (name, date of birth, academic history, etc.), please contact the admin.</p>
            </li>
            {% endfor %}
        </ul>
        {% endif %} {% endcomment %}

        <div class="info-box">
            <strong>Need to Update Other Information?</strong>
            <p>You can only edit contact details, addresses, bank information, and documents here. For any other changes, please contact the Admin, For More Details Visit <a href="{% url 'help_and_support' %}" style="color: var(--info-text); font-weight: 600; text-decoration: underline;">Help & Support</a> page.</p>
        </div>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Contact Information -->
            <div class="card">
                <h2 class="card-title">Contact Information</h2>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="student_email">Email Address *</label>
                        <input type="email" id="student_email" name="student_email" value="{{ student.student_email|default:'' }}" required>
                    </div>
                    <div class="input-group">
                        <label for="student_mobile">Student Mobile Number</label>
                        <input type="tel" id="student_mobile" name="student_mobile" value="{{ personalinfo.student_mobile|default:'' }}" pattern="[0-9]{10}" maxlength="10">
                    </div>
                    <div class="input-group">
                        <label for="father_mobile">Father's Mobile Number</label>
                        <input type="tel" id="father_mobile" name="father_mobile" value="{{ personalinfo.father_mobile|default:'' }}" pattern="[0-9]{10}" maxlength="10">
                    </div>
                    <div class="input-group">
                        <label for="mother_mobile">Mother's Mobile Number</label>
                        <input type="tel" id="mother_mobile" name="mother_mobile" value="{{ personalinfo.mother_mobile|default:'' }}" pattern="[0-9]{10}" maxlength="10">
                    </div>
                </div>
                <div class="form-grid-full" style="margin-top: 20px;">
                    <div class="input-group">
                        <label for="present_address">Present Address</label>
                        <textarea id="present_address" name="present_address">{{ personalinfo.present_address|default:'' }}</textarea>
                    </div>
                    <div class="input-group">
                        <label for="permanent_address">Permanent Address</label>
                        <textarea id="permanent_address" name="permanent_address">{{ personalinfo.permanent_address|default:'' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Bank Details -->
            <div class="card">
                <h2 class="card-title">Bank Account Details</h2>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="account_holder_name">Account Holder Name</label>
                        <input type="text" id="account_holder_name" name="account_holder_name" value="{{ bankdetails.account_holder_name|default:'' }}">
                    </div>
                    <div class="input-group">
                        <label for="account_number">Account Number</label>
                        <input type="text" id="account_number" name="account_number" value="{{ bankdetails.account_number|default:'' }}">
                    </div>
                    <div class="input-group">
                        <label for="bank_name">Bank Name</label>
                        <input type="text" id="bank_name" name="bank_name" value="{{ bankdetails.bank_name|default:'' }}">
                    </div>
                    <div class="input-group">
                        <label for="branch_name">Branch Name</label>
                        <input type="text" id="branch_name" name="branch_name" value="{{ bankdetails.branch_name|default:'' }}">
                    </div>
                    <div class="input-group">
                        <label for="ifsc_code">IFSC Code</label>
                        <input type="text" id="ifsc_code" name="ifsc_code" value="{{ bankdetails.ifsc_code|default:'' }}" maxlength="11" style="text-transform: uppercase;">
                    </div>
                </div>
            </div>

            <!-- Document Management -->
            <div class="card">
                <h2 class="card-title">Document Uploads</h2>
                <div class="document-grid">
                    <div class="document-upload-item">
                        <label for="student_photo">Student Photo</label>
                        <input type="file" id="student_photo" name="student_photo" accept="image/*">
                        {% if studentdocuments.student_photo %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.student_photo.url }}" target="_blank">View Photo</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="aadhaar_card">Aadhaar Card</label>
                        <input type="file" id="aadhaar_card" name="aadhaar_card" accept="image/*,application/pdf">
                        {% if studentdocuments.aadhaar_card %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.aadhaar_card.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="community_certificate">Community Certificate</label>
                        <input type="file" id="community_certificate" name="community_certificate" accept="image/*,application/pdf">
                        {% if studentdocuments.community_certificate %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.community_certificate.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="sslc_marksheet">SSLC Marksheet</label>
                        <input type="file" id="sslc_marksheet" name="sslc_marksheet" accept="image/*,application/pdf">
                        {% if studentdocuments.sslc_marksheet %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.sslc_marksheet.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="hsc_marksheet">HSC Marksheet</label>
                        <input type="file" id="hsc_marksheet" name="hsc_marksheet" accept="image/*,application/pdf">
                        {% if studentdocuments.hsc_marksheet %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.hsc_marksheet.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="income_certificate">Income Certificate</label>
                        <input type="file" id="income_certificate" name="income_certificate" accept="image/*,application/pdf">
                        {% if studentdocuments.income_certificate %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.income_certificate.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="bank_passbook">Bank Passbook</label>
                        <input type="file" id="bank_passbook" name="bank_passbook" accept="image/*,application/pdf">
                        {% if studentdocuments.bank_passbook %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.bank_passbook.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>

                    <div class="document-upload-item">
                        <label for="driving_license">Driving License (Optional)</label>
                        <input type="file" id="driving_license" name="driving_license" accept="image/*,application/pdf">
                        {% if studentdocuments.driving_license %}
                        <div class="current-file">Current: <a href="{{ studentdocuments.driving_license.url }}" target="_blank">View Document</a></div>
                        {% else %}
                        <div class="current-file not-uploaded">Not uploaded yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="button-group">
                <a href="{% url 'student_dashboard' %}" class="cancel-btn">Cancel</a>
                <button type="submit" class="submit-btn">Save Changes</button>
            </div>
        </form>
    </div>
</body>
</html>