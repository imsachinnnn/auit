<div class="news-ticker-panel content-section">
    <div class="section-title-row"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color, #e2e8f0);">
        <div class="section-title"
            style="display: flex; align-items: center; gap: 10px; font-weight: 600; color: var(--text-main);">
            ðŸ“¢ Announcements
        </div>
        <div class="news-filters" style="display: flex; gap: 5px;">
            <button class="filter-btn active" onclick="filterNews('all', this)">All</button>
            {% if staff %}
            <button class="filter-btn" onclick="filterNews('staff', this)">Staff</button>
            {% endif %}
            <button class="filter-btn" onclick="filterNews('student', this)">Students</button>
        </div>
    </div>

    <div class="news-scroll-window" id="newsWindow">
        <div class="news-scroll-content" id="newsContent">
            {% if news_list %}
            {% for news in news_list %}
            <div class="news-item" data-target="{{ news.target|lower }}">
                <span class="news-date">{{ news.date|date:"M d, Y" }} <span
                        style="font-weight: 400; opacity: 0.7; font-size: 0.9em; margin-left: 5px;">{{news.date|time:"h:iA" }}</span></span>
                {% if news.link %}
                <p><a href="{{ news.link }}" target="_blank" class="news-link">
                        {{ news.content }} <span style="font-size: 0.8em;">ðŸ”—</span>
                    </a>
                    <span class="news-tag {{ news.target|lower }}">{{ news.target }}</span>
                </p>
                {% else %}
                <p>{{ news.content }} <span class="news-tag {{ news.target|lower }}">{{ news.target }}</span></p>
                {% endif %}
            </div>
            {% endfor %}
            {% else %}
            <div class="news-item" style="text-align: center; color: var(--text-muted);">
                <p>No new announcements.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Native Theme Integration */
    .news-ticker-panel {
        background: var(--card-bg, #fff);
        border-radius: var(--radius, 12px);
        box-shadow: var(--shadow, 0 4px 6px rgba(0, 0, 0, 0.05));
        padding: 20px;
        margin-top: 25px;
        border: 1px solid var(--border-color, #e2e8f0);
    }

    /* Filter Buttons */
    .filter-btn {
        background: transparent;
        border: 1px solid var(--border-color, #e2e8f0);
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        cursor: pointer;
        color: var(--text-muted, #64748b);
        transition: all 0.2s;
    }

    .filter-btn:hover {
        background: var(--bg-body, #f8fafc);
        color: var(--text-main, #334155);
    }

    .filter-btn.active {
        background: var(--primary, #5a7d7c);
        color: white;
        border-color: var(--primary, #5a7d7c);
    }

    /* Scroll Area */
    .news-scroll-window {
        height: 400px;
        overflow: hidden;
        position: relative;
    }

    .news-scroll-window::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(to top, var(--card-bg, #fff), transparent);
        pointer-events: none;
    }

    .news-scroll-content {
        position: absolute;
        width: 100%;
        animation: scroll-vertical 25s linear infinite;
        top: 100%;
    }

    .news-ticker-panel:hover .news-scroll-content {
        animation-play-state: paused;
    }

    /* News Items */
    .news-item {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px dashed var(--border-color, #e2e8f0);
        display: block;
        /* Default display */
    }

    .news-item.hidden {
        display: none !important;
    }

    .news-item:last-child {
        border-bottom: none;
    }

    .news-date {
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--primary-color, #2c3e50);
        margin-bottom: 5px;
        display: block;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .news-item p {
        margin: 0;
        font-size: 0.95rem;
        color: var(--text-main, #334155);
        line-height: 1.6;
    }

    .news-link {
        color: var(--accent-color, #2563eb);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
    }

    .news-link:hover {
        color: var(--primary-color, #1e293b);
        text-decoration: underline;
    }

    /* News Tags */
    .news-tag {
        font-size: 0.65rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 8px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        vertical-align: middle;
        background: #e2e8f0;
        color: #64748b;
    }

    .news-tag.all {
        background: #dcfce7;
        color: #166534;
    }

    .news-tag.staff {
        background: #dbeafe;
        color: #1e40af;
    }

    .news-tag.student {
        background: #fae8ff;
        color: #86198f;
    }

    @keyframes scroll-vertical {
        0% {
            top: 100%;
        }

        100% {
            top: -150%;
        }
    }
</style>

<script>
    function filterNews(type, btn) {
        // Update Buttons
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Filter Items
        const items = document.querySelectorAll('.news-item');
        items.forEach(item => {
            const target = item.getAttribute('data-target');
            if (type === 'all' || target === type || (type === 'student' && target === 'student') || (type === 'staff' && target === 'staff') || target === 'all') {
                // Logic: 
                // 'all' filter shows everything.
                // 'student' filter shows 'student' AND 'all' tagged items? Usually yes, students see 'All' and 'Student'.
                // 'staff' filter shows 'staff' AND 'all' tagged items.

                // Let's refine based on user request: "filter like all staff,students"
                // Usually filters are exclusive or inclusive. 
                // If I click "Students", I expect to see things relevant to students. That includes "Student" specific AND "All".

                if (type === 'all') {
                    item.classList.remove('hidden');
                } else if (type === 'student') {
                    if (target === 'student' || target === 'all') {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                } else if (type === 'staff') {
                    if (target === 'staff' || target === 'all') {
                        item.classList.remove('hidden');
                    } else {
                        item.classList.add('hidden');
                    }
                }
            } else {
                item.classList.add('hidden');
            }
        });

        // Reset Animation to ensure flow isn't broken
        const content = document.getElementById('newsContent');
        content.style.animation = 'none';
        content.offsetHeight; /* trigger reflow */
        content.style.animation = 'scroll-vertical 25s linear infinite';
    }
</script>