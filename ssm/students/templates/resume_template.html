<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <title>{{ student.student_name }} - Resume</title>
    <style type="text/css">
        @page {
            size: A4;
            margin: 0.45in;
            /* Optimized for 1 page */
        }

        body {
            font-family: "Helvetica", "Arial", sans-serif;
            font-size: 10.5pt;
            /* Optimized font size */
            color: #000;
            line-height: 1.35;
        }

        /* Header */
        .header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 18px;
        }

        .name {
            font-size: 22pt;
            font-weight: bold;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .contact-info {
            font-size: 10pt;
            color: #000;
        }

        .contact-separator {
            margin: 0 5px;
            color: #000;
        }

        /* Sections */
        .section {
            margin-bottom: 14px;
            /* Reduced section gap */
        }

        .section-title {
            font-size: 12.5pt;
            font-weight: bold;
            color: #000;
            text-transform: uppercase;
            border-bottom: 1px solid #000;
            padding-bottom: 3px;
            margin-bottom: 8px;
        }

        /* Content */
        .content-block {
            margin-bottom: 8px;
        }

        .block-title {
            font-weight: bold;
            font-size: 11pt;
            color: #000;
        }

        /* Flex-like table for title + role */
        .title-row {
            width: 100%;
            border: none;
            margin-bottom: 2px;
        }

        .title-left {
            text-align: left;
            font-weight: bold;
            font-size: 11pt;
            vertical-align: bottom;
        }

        .title-right {
            text-align: right;
            font-weight: normal;
            font-size: 10pt;
            font-style: italic;
            vertical-align: bottom;
        }

        .block-subtitle {
            font-style: italic;
            color: #000;
            font-size: 10pt;
            margin-bottom: 2px;
        }

        .block-desc {
            text-align: justify;
            font-size: 10.5pt;
        }

        /* Tables */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10.5pt;
        }

        .info-table th {
            text-align: left;
            font-weight: bold;
            border-bottom: 1px solid #000;
            padding: 3px 0;
            color: #000;
        }

        .info-table td {
            padding: 3px 0;
            border-bottom: 1px solid #ccc;
        }

        .grade-col {
            text-align: right;
        }

        /* Skills */
        .skills-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .skill-item {
            display: inline-block;
            margin-right: 12px;
            padding: 0;
            font-size: 10.5pt;
            font-weight: normal;
        }

        /* Coursework */
        .course-grid {
            display: block;
        }

        .course-item {
            display: inline-block;
            width: 32%;
            margin-bottom: 4px;
            font-size: 10pt;
        }

        .bullet {
            color: #000;
            font-weight: bold;
            margin-right: 4px;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <div class="header">
        <div class="name">{{ student.student_name }}</div>
        <div class="contact-info">
            {{ student.student_email }}
            <span class="contact-separator">|</span>
            {{ personal.student_mobile }}
            {% if personal.present_address %}
            <span class="contact-separator">|</span>
            {{ personal.present_address|truncatechars:50 }}
            {% endif %}
        </div>
    </div>

    <!-- Objective / Summary -->
    {% if ai_data.summary or other.ambition %}
    <div class="section">
        <div class="section-title">Professional Summary</div>
        <div class="content-block" style="text-align: justify;">
            {{ ai_data.summary|default:other.ambition }}
        </div>
    </div>
    {% endif %}

    <!-- Education -->
    <div class="section">
        <div class="section-title">Education</div>
        <table class="info-table">
            <tr>
                <th width="35%">Degree / Course</th>
                <th width="35%">Institution</th>
                <th width="15%">Year</th>
                <th width="15%" class="grade-col">Grade</th>
            </tr>

            <!-- CURRENT EDUCATION LOGIC -->
            <!-- Check for PhD Pursuing -->
            {% if student.program_level == 'PHD' %}
            <tr>
                <td><strong>PhD ({{ phd.phd_specialization|default:"Research Scholar" }})</strong></td>
                <td>{{ phd.phd_university|default:"Annamalai University" }}</td>
                <td>{{ phd.phd_year_of_joining|default:"Present" }} - Present</td>
                <td class="grade-col">Pursuing</td>
            </tr>
            {% endif %}

            <!-- Check for PG Pursuing/Completed -->
            {% if student.program_level == 'PG' %}
            <!-- If PG details exist and have passing year, assume completed/final year, else pursuing logic -->
            {% if pg and pg.pg_year_of_passing %}
            <tr>
                <td><strong>{{ pg.pg_course }}</strong></td>
                <td>{{ pg.pg_university }}</td>
                <td>{{ pg.pg_year_of_passing }}</td>
                <td class="grade-col">{{ pg.pg_ogpa }} OGPA</td>
            </tr>
            {% else %}
            <tr>
                <!-- Fallback if specific PG obj missing but student is PG -->
                <td><strong>{{ pg.pg_course|default:"Postgraduate Degree" }}</strong></td>
                <td>{{ pg.pg_university|default:"Annamalai University" }}</td>
                <td>{{ student.joining_year|default:"2023" }} - Present</td>
                <td class="grade-col">Pursuing</td>
            </tr>
            {% endif %}
            {% endif %}

            <!-- Check for UG Pursuing - Only show if student is UG level OR if we want to show UG background for PG students -->
            {% if student.program_level == 'UG' %}
            <!-- If UG details exist and have passing year -->
            {% if ug and ug.ug_year_of_passing %}
            <tr>
                <td><strong>{{ ug.ug_course }}</strong></td>
                <td>{{ ug.ug_university }}</td>
                <td>{{ ug.ug_year_of_passing }}</td>
                <td class="grade-col">{{ ug.ug_ogpa|default:"-" }} OGPA</td>
            </tr>
            {% else %}
            <tr>
                <td><strong>B.E. {{ ug.ug_course|default:"Information Technology" }}</strong></td>
                <td>{{ ug.ug_university|default:"Annamalai University" }}</td>
                <td>{{ student.joining_year|default:"2023" }} - Present</td>
                <td class="grade-col">Pursuing</td>
            </tr>
            {% endif %}
            {% elif student.program_level == 'PG' or student.program_level == 'PHD' %}
            <!-- For PG/PhD, show valid UG history if exists -->
            {% if ug %}
            <tr>
                <td><strong>{{ ug.ug_course }}</strong></td>
                <td>{{ ug.ug_university }}</td>
                <td>{{ ug.ug_year_of_passing }}</td>
                <td class="grade-col">{{ ug.ug_ogpa }} OGPA</td>
            </tr>
            {% endif %}
            {% endif %}

            <!-- Diploma -->
            {% if diploma %}
            <tr>
                <td>Diploma</td>
                <td>{{ diploma.diploma_college_name }}</td>
                <td>{{ diploma.diploma_year_of_passing }}</td>
                <td class="grade-col">{{ diploma.diploma_percentage }}%</td>
            </tr>
            {% endif %}

            <!-- HSC -->
            {% if academic.hsc_percentage %}
            <tr>
                <td>HSC / 12th Grade</td>
                <td>{{ academic.hsc_school_name }}</td>
                <td>{{ academic.hsc_year_of_passing }}</td>
                <td class="grade-col">{{ academic.hsc_percentage }}%</td>
            </tr>
            {% endif %}

            <!-- SSLC -->
            {% if academic.sslc_percentage %}
            <tr>
                <td>SSLC / 10th Grade</td>
                <td>{{ academic.sslc_school_name }}</td>
                <td>{{ academic.sslc_year_of_passing }}</td>
                <td class="grade-col">{{ academic.sslc_percentage }}%</td>
            </tr>
            {% endif %}
        </table>
    </div>

    <!-- Technical Skills -->
    {% if ai_data.hard_skills or skills %}
    <div class="section">
        <div class="section-title">Technical Skills</div>
        <div class="skills-list">
            {% if ai_data.hard_skills %}
            {% for skill in ai_data.hard_skills %}
            <span class="skill-item">
                <span class="bullet">&bull;</span> {{ skill }}
            </span>
            {% endfor %}
            {% else %}
            {% for skill in skills %}
            <span class="skill-item">
                <span class="bullet">&bull;</span> {{ skill.skill_name }}
                <span style="font-size:9.5pt; color:#222;">({{ skill.proficiency }})</span>
            </span>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Soft Skills -->
    {% if ai_data.soft_skills %}
    <div class="section">
        <div class="section-title">Soft Skills</div>
        <div class="skills-list">
            {% for skill in ai_data.soft_skills %}
            <span class="skill-item">
                <span class="bullet">&bull;</span> {{ skill }}
            </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Academic Projects -->
    {% if ai_data.projects_enhanced or projects %}
    <div class="section">
        <div class="section-title">Academic Projects</div>

        {% if ai_data.projects_enhanced %}
        {% for project in ai_data.projects_enhanced %}
        <div class="content-block">
            <!-- Using Table for foolproof alignment check -->
            <table class="title-row">
                <tr>
                    <td class="title-left">{{ project.title }}</td>
                    <td class="title-right">{{ project.role }}</td>
                </tr>
            </table>
            <div class="block-desc" style="margin-top:2px;">
                {{ project.description }}
            </div>
        </div>
        {% endfor %}
        {% else %}
        {% for project in projects %}
        <div class="content-block">
            <table class="title-row">
                <tr>
                    <td class="title-left">
                        {{ project.title }}
                        {% if project.link %}
                        <a href="{{ project.link }}" style="font-size:9pt; color:#000; text-decoration:none;">[Link]</a>
                        {% endif %}
                    </td>
                    <td class="title-right">{{ project.role }}</td>
                </tr>
            </table>
            <div class="block-subtitle">Tech: {{ project.technologies }}</div>
            <div class="block-desc">
                {{ project.description }}
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    {% endif %}

    <!-- Relevant Coursework -->
    {% if ai_data.coursework_highlight or coursework %}
    <div class="section">
        <div class="section-title">Relevant Coursework</div>
        <div class="course-grid">
            {% if ai_data.coursework_highlight %}
            {% for subject in ai_data.coursework_highlight %}
            <div class="course-item">
                <span class="bullet">&bull;</span> {{ subject }}
            </div>
            {% endfor %}
            {% else %}
            {% for subject in coursework %}
            <div class="course-item">
                <span class="bullet">&bull;</span> {{ subject.name }}
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endif %}

</body>

</html>